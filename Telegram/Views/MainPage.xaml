<controls:CorePage x:Class="Telegram.Views.MainPage"
                   xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                   xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                   xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                   xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                   xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
                   xmlns:icons="using:Telegram.Assets.Icons"
                   xmlns:controls="using:Telegram.Controls"
                   xmlns:cells="using:Telegram.Controls.Cells"
                   xmlns:contacts="using:Telegram.Controls.Contacts"
                   xmlns:stories="using:Telegram.Controls.Stories"
                   xmlns:views="using:Telegram.Controls.Views"
                   xmlns:viewModels="using:Telegram.ViewModels"
                   xmlns:local="using:Telegram.Views"
                   mc:Ignorable="d"
                   Loaded="OnLoaded"
                   Unloaded="OnUnloaded">

    <Page.Transitions>
        <TransitionCollection>
            <NavigationThemeTransition>
                <SuppressNavigationTransitionInfo />
            </NavigationThemeTransition>
        </TransitionCollection>
    </Page.Transitions>

    <Page.Resources>
        <CollectionViewSource x:Name="NavigationResults"
                              Source="{x:Bind ViewModel.NavigationItems}"
                              IsSourceGrouped="True" />
    </Page.Resources>

    <Grid x:Name="LayoutRoot">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>

        <muxc:ProgressBar x:Name="State"
                          VerticalAlignment="Top"
                          Background="Transparent"
                          IsHitTestVisible="False"
                          Grid.Column="1" />

        <Grid x:Name="TitleBarrr"
              Height="40"
              Margin="48,0,0,0"
              Background="Transparent"
              Grid.Column="1"
              Canvas.ZIndex="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <Border x:Name="TitleBarHandle"
                    Background="Transparent"
                    Grid.Column="2" />

            <HyperlinkButton x:Name="TitleBarLogo"
                             Click="Status_Click"
                             Style="{StaticResource EmptyHyperlinkButtonStyle}"
                             IsTabStop="False"
                             Margin="-10,0,4,0"
                             Width="40"
                             Height="40"
                             Grid.Column="1">
                <Grid Background="Transparent">
                    <Canvas x:Name="LogoBasic"
                            Width="16"
                            Height="14"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                        <Path Data="M14.6025 0.109437C9.96891 1.86558 5.33409 3.61851 0.69863 5.36857L0.69863 5.36857C0.391755 5.48441 0.151119 5.65913 0.0247189 5.96984L0.0247189 5.96984C-0.00823964 6.06584 -0.00823964 6.14328 0.0247189 6.21976L0.0247189 6.21976C0.169358 6.5228 0.426634 6.67031 0.735112 6.77303L0.735112 6.77303C1.51366 7.03255 2.29669 7.28279 3.0586 7.58486L3.0586 7.58486C3.77315 7.8687 4.38978 7.77046 5.0301 7.35575L5.0301 7.35575C7.12511 5.99896 9.23964 4.67322 11.3497 3.34011L11.3497 3.34011C11.5299 3.22651 11.7417 2.98396 11.9478 3.23324L11.9478 3.23324C12.1769 3.51067 11.8617 3.65819 11.7062 3.80859L11.7062 3.80859C10.158 5.30617 8.60157 6.79479 7.05087 8.28949L7.05087 8.28949C6.55616 8.76629 6.57984 9.14804 7.12959 9.54644L7.12959 9.54644C8.67037 10.6648 10.2121 11.781 11.7619 12.8869L11.7619 12.8869C11.9414 13.0152 12.165 13.1211 12.381 13.1531L12.381 13.1531C12.9948 13.2437 13.4037 12.8773 13.5663 12.1429L13.5663 12.1429C13.7676 11.2299 13.9692 10.3167 14.1692 9.4034L14.1692 9.4034C14.7685 6.66327 15.3653 3.92219 15.9685 1.18303L15.9685 1.18303C16.0463 0.82847 15.9852 0.522555 15.7272 0.264637L15.7272 0.264637C15.5365 0.0742392 15.3317 0 15.1148 0L15.1148 0C14.9506 0 14.7794 0.0425605 14.6025 0.109439"
                              StrokeThickness="0"
                              Stroke="#00000000">
                            <Path.Fill>
                                <LinearGradientBrush StartPoint="0.355035215616226,0"
                                                     EndPoint="0.916017889976501,0.0104505941271782"
                                                     MappingMode="RelativeToBoundingBox">
                                    <LinearGradientBrush.GradientStops>
                                        <GradientStopCollection>
                                            <GradientStop Offset="0"
                                                          Color="#008ED4" />
                                            <GradientStop Offset="1"
                                                          Color="#25AEF3" />
                                        </GradientStopCollection>
                                    </LinearGradientBrush.GradientStops>
                                </LinearGradientBrush>
                            </Path.Fill>
                        </Path>
                        <Path Data="M14.6025 0.109437C9.96891 1.86558 5.33409 3.61851 0.69863 5.36857L0.69863 5.36857C0.391755 5.48441 0.151119 5.65913 0.0247189 5.96984L0.0247189 5.96984C-0.00823964 6.06584 -0.00823964 6.14328 0.0247189 6.22008L0.0247189 6.22008C0.169358 6.52248 0.426634 6.67031 0.735112 6.77303L0.735112 6.77303C1.51366 7.03255 2.29669 7.28279 3.0586 7.58486L3.0586 7.58486C3.33316 7.69398 3.59332 7.74646 3.84547 7.74646L3.84547 7.74646C4.25059 7.74646 4.63554 7.6111 5.0301 7.35575L5.0301 7.35575C7.12511 5.99896 9.23964 4.67322 11.3497 3.34012L11.3497 3.34012C11.4729 3.26236 11.6105 3.12444 11.7516 3.12444L11.7516 3.12444C11.8166 3.12444 11.8825 3.1542 11.9478 3.23323L11.9478 3.23323C12.1775 3.51067 11.8617 3.65819 11.7062 3.80858L11.7062 3.80858C10.158 5.30617 8.60157 6.79479 7.05087 8.28949L7.05087 8.28949C6.55616 8.76629 6.57984 9.14804 7.12959 9.54644L7.12959 9.54644C8.67037 10.6648 10.2121 11.781 11.7619 12.8869L11.7619 12.8869C11.9414 13.0152 12.165 13.1211 12.381 13.1531L12.381 13.1531C12.4425 13.1624 12.5017 13.1666 12.559 13.1666L12.559 13.1666C13.0742 13.1666 13.4204 12.8037 13.5663 12.1429L13.5663 12.1429C13.7676 11.2299 13.9692 10.3167 14.1692 9.4034L14.1692 9.4034C14.7685 6.66327 15.3653 3.92219 15.9685 1.18303L15.9685 1.18303C16.0463 0.828471 15.9852 0.522555 15.7272 0.264637L15.7272 0.264637C15.5365 0.0742392 15.3317 0 15.1148 0L15.1148 0C14.9503 0 14.7794 0.0425605 14.6025 0.109439M3.17668 7.28759C2.52613 7.02935 1.85382 6.80663 1.2039 6.59127L1.2039 6.59127L0.836229 6.46967C0.558793 6.3772 0.408394 6.26872 0.320717 6.09688L0.320717 6.09688C0.321676 6.09336 0.322636 6.08824 0.324877 6.0812L0.324877 6.0812C0.405834 5.88984 0.552073 5.766 0.811909 5.66808L0.811909 5.66808C5.44737 3.91771 10.0825 2.16509 14.7161 0.408632L14.7161 0.408632C14.8738 0.349113 15.0044 0.319992 15.1148 0.319992L15.1148 0.319992C15.2636 0.319992 15.3823 0.372792 15.5007 0.490869L15.5007 0.490869C15.6687 0.658868 15.7151 0.845106 15.6556 1.1139L15.6556 1.1139C15.2357 3.023 14.8188 4.93274 14.4012 6.84247L14.4012 6.84247L13.8565 9.33524C13.6569 10.2482 13.4553 11.1611 13.2537 12.0738L13.2537 12.0738C13.0831 12.8469 12.6889 12.8469 12.559 12.8469L12.559 12.8469C12.5174 12.8469 12.4732 12.8434 12.4278 12.8366L12.4278 12.8366C12.279 12.8149 12.1042 12.7378 11.9474 12.6264L11.9474 12.6264C10.4844 11.5822 9.03836 10.5368 7.31743 9.28788L7.31743 9.28788C7.13087 9.15252 7.02463 9.02484 7.01823 8.92852L7.01823 8.92852C7.01119 8.82997 7.10175 8.68501 7.27295 8.51989L7.27295 8.51989C7.89694 7.91862 8.52189 7.31831 9.14685 6.71767L9.14685 6.71767C10.0748 5.82552 11.0035 4.9337 11.9286 4.03835L11.9286 4.03835C11.9516 4.01659 11.9791 3.99451 12.007 3.97211L12.007 3.97211C12.1321 3.87099 12.3212 3.71867 12.3462 3.47195L12.3462 3.47195C12.3615 3.31868 12.3106 3.16988 12.1942 3.02908L12.1942 3.02908C12.0409 2.8438 11.8684 2.80444 11.7516 2.80444L11.7516 2.80444C11.5427 2.80444 11.3785 2.92508 11.2591 3.01308L11.2591 3.01308C11.2316 3.03324 11.2047 3.0534 11.1788 3.06972L11.1788 3.06972L9.99803 3.81499C8.30878 4.88058 6.56192 5.98232 4.85634 7.08695L4.85634 7.08695C4.49858 7.31894 4.17763 7.42646 3.84547 7.42646L3.84547 7.42646C3.6314 7.42646 3.41252 7.38102 3.17668 7.28759"
                              StrokeThickness="0"
                              Stroke="#00000000">
                            <Path.Fill>
                                <LinearGradientBrush StartPoint="4.80645803691004E-06,0.5"
                                                     EndPoint="0.9999920129776,0.5"
                                                     MappingMode="RelativeToBoundingBox">
                                    <LinearGradientBrush.GradientStops>
                                        <GradientStopCollection>
                                            <GradientStop Offset="0"
                                                          Color="#008ED4" />
                                            <GradientStop Offset="0.303017"
                                                          Color="#008ED4" />
                                            <GradientStop Offset="0.9"
                                                          Color="#25AEF3" />
                                            <GradientStop Offset="1"
                                                          Color="#25AEF3" />
                                        </GradientStopCollection>
                                    </LinearGradientBrush.GradientStops>
                                </LinearGradientBrush>
                            </Path.Fill>
                        </Path>
                    </Canvas>

                    <Canvas x:Name="LogoPremium"
                            Width="16"
                            Height="16"
                            Margin="0,-2,0,0"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center">
                        <Path Data="M7.6,13.2L4,15.4c-0.4,0.2-0.9,0.1-1.1-0.3c-0.1-0.2-0.1-0.4-0.1-0.6l0.6-2.2c0.2-0.8,0.7-1.4,1.5-1.8l3.9-1.9 C8.9,8.7,9,8.4,8.9,8.3C8.9,8.1,8.7,8,8.5,8.1L4.2,8.8C3.3,9,2.4,8.7,1.7,8.1L0.3,7c-0.3-0.3-0.4-0.8-0.1-1.1 c0.1-0.2,0.3-0.3,0.5-0.3L5,5.3c0.3,0,0.6-0.2,0.7-0.5l1.6-3.9c0.2-0.4,0.6-0.6,1-0.4c0.2,0.1,0.3,0.2,0.4,0.4l1.6,3.9 c0.1,0.3,0.4,0.5,0.7,0.5l4.2,0.3C15.7,5.7,16,6,16,6.5c0,0.2-0.1,0.4-0.3,0.5l-3.2,2.7c-0.2,0.2-0.3,0.5-0.3,0.8l1,4.1 c0.1,0.4-0.2,0.8-0.6,0.9c-0.2,0-0.4,0-0.6-0.1l-3.6-2.2C8.1,13.1,7.8,13.1,7.6,13.2z"
                              Style="{StaticResource PremiumStar}" />
                    </Canvas>

                    <controls:CustomEmojiIcon x:Name="LogoEmoji"
                                              HorizontalAlignment="Center"
                                              VerticalAlignment="Center" />
                </Grid>
            </HyperlinkButton>

            <TextBlock x:Name="TitleText"
                       VerticalAlignment="Center"
                       TextLineBounds="TrimToCapHeight"
                       TextWrapping="NoWrap"
                       AutomationProperties.LiveSetting="Assertive"
                       Foreground="{ThemeResource PageHeaderForegroundBrush}"
                       Style="{StaticResource CaptionTextBlockStyle}"
                       IsHitTestVisible="False"
                       Margin="0,2,6,0"
                       Grid.Column="2">
                <Run x:Name="StateLabel" />
                <Run x:Name="MemoryLabel" />
            </TextBlock>
        </Grid>

        <Grid x:Load="False"
              x:Name="ChatTabsLeft"
              Grid.Row="1">
            <Border BackgroundSizing="OuterBorderEdge"
                    Background="{ThemeResource LayerOnMicaBaseAltFillColorDefaultBrush}"
                    BorderBrush="{ThemeResource NavigationViewContentGridBorderBrush}"
                    BorderThickness="0,0,1,0"
                    Margin="0,-40,0,0" />

            <controls:TopNavView x:Name="ChatFoldersSide"
                                 AutomationProperties.Name="{CustomResource Filters}"
                                 ItemsSource="{x:Bind NavigationResults.View}"
                                 SelectedItem="{x:Bind ViewModel.SelectedFolder, Mode=OneWay}"
                                 SelectionChanged="ChatFolders_SelectionChanged"
                                 ItemContextRequested="ChatFolder_ContextRequested"
                                 ChoosingGroupHeaderContainer="ChatFolders_ChoosingGroupHeaderContainer"
                                 Orientation="Vertical"
                                 AllowDrop="True"
                                 CanDragItems="True"
                                 CanReorderItems="False"
                                 DragItemsStarting="ChatFolders_DragItemsStarting"
                                 DragItemsCompleted="ChatFolders_DragItemsCompleted"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.HorizontalScrollMode="Disabled"
                                 ScrollViewer.VerticalScrollBarVisibility="Hidden"
                                 ScrollViewer.VerticalScrollMode="Auto"
                                 Height="Auto"
                                 Width="72"
                                 Grid.Row="1">
                <controls:TopNavView.ItemTemplate>
                    <DataTemplate>
                        <cells:ChatFolderCell />
                    </DataTemplate>
                </controls:TopNavView.ItemTemplate>
                <controls:TopNavView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <ItemsStackPanel Orientation="Vertical" />
                    </ItemsPanelTemplate>
                </controls:TopNavView.ItemsPanel>
                <controls:TopNavView.ItemContainerStyle>
                    <Style TargetType="controls:TopNavViewItem">
                        <Setter Property="HorizontalAlignment"
                                Value="Stretch" />
                        <Setter Property="VerticalAlignment"
                                Value="Stretch" />
                        <Setter Property="HorizontalContentAlignment"
                                Value="Stretch" />
                        <Setter Property="VerticalContentAlignment"
                                Value="Stretch" />
                        <Setter Property="UseSystemFocusVisuals"
                                Value="True" />
                        <Setter Property="Margin"
                                Value="0,0,0,4" />
                        <Setter Property="CornerRadius"
                                Value="4" />
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="controls:TopNavViewItem">
                                    <Grid Background="Transparent">
                                        <VisualStateManager.CustomVisualStateManager>
                                            <controls:TopNavViewItemManager />
                                        </VisualStateManager.CustomVisualStateManager>
                                        <VisualStateManager.VisualStateGroups>
                                            <VisualStateGroup x:Name="CommonStates">
                                                <VisualState x:Name="Normal" />
                                                <VisualState x:Name="PointerOver">
                                                    <VisualState.Setters>
                                                        <Setter Target="Plate.Background"
                                                                Value="{ThemeResource NavigationViewItemBackgroundPointerOver}" />
                                                    </VisualState.Setters>
                                                </VisualState>
                                                <VisualState x:Name="Pressed">
                                                    <VisualState.Setters>
                                                        <Setter Target="Plate.Background"
                                                                Value="{ThemeResource NavigationViewItemBackgroundPressed}" />
                                                    </VisualState.Setters>
                                                </VisualState>
                                                <VisualState x:Name="Selected">
                                                    <VisualState.Setters>
                                                        <Setter Target="Plate.Background"
                                                                Value="{ThemeResource NavigationViewItemBackgroundSelected}" />
                                                    </VisualState.Setters>
                                                </VisualState>
                                                <VisualState x:Name="PointerOverSelected">
                                                    <VisualState.Setters>
                                                        <Setter Target="Plate.Background"
                                                                Value="{ThemeResource NavigationViewItemBackgroundSelectedPointerOver}" />
                                                    </VisualState.Setters>
                                                </VisualState>
                                                <VisualState x:Name="PressedSelected">
                                                    <VisualState.Setters>
                                                        <Setter Target="Plate.Background"
                                                                Value="{ThemeResource NavigationViewItemBackgroundSelectedPressed}" />
                                                    </VisualState.Setters>
                                                </VisualState>
                                            </VisualStateGroup>
                                        </VisualStateManager.VisualStateGroups>
                                        <Border x:Name="Plate"
                                                Width="64"
                                                Margin="4,0,4,0"
                                                CornerRadius="4" />
                                        <ContentPresenter x:Name="ContentPresenter"
                                                          Grid.Column="1"
                                                          Margin="0"
                                                          TextWrapping="NoWrap"
                                                          Foreground="{TemplateBinding Foreground}"
                                                          ContentTransitions="{TemplateBinding ContentTransitions}"
                                                          ContentTemplate="{TemplateBinding ContentTemplate}"
                                                          Content="{TemplateBinding Content}"
                                                          HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                          ContentTemplateSelector="{TemplateBinding ContentTemplateSelector}"
                                                          VerticalAlignment="Center"
                                                          AutomationProperties.AccessibilityView="Raw" />
                                        <Grid x:Name="SelectionIndicatorGrid"
                                              Margin="4,4,4,4"
                                              HorizontalAlignment="Left"
                                              VerticalAlignment="Center">
                                            <Rectangle x:Name="SelectionIndicator"
                                                       Width="3"
                                                       Height="24"
                                                       Fill="{ThemeResource NavigationViewSelectionIndicatorForeground}"
                                                       Opacity="0"
                                                       RadiusX="3"
                                                       RadiusY="3" />
                                        </Grid>
                                    </Grid>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </controls:TopNavView.ItemContainerStyle>
                <controls:TopNavView.GroupStyle>
                    <GroupStyle>
                        <GroupStyle.HeaderContainerStyle>
                            <Style TargetType="ListViewHeaderItem">
                                <Setter Property="MinHeight"
                                        Value="0" />
                                <Setter Property="IsTabStop"
                                        Value="False" />
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate>
                                            <Rectangle Fill="{ThemeResource CardStrokeColorDefaultBrush}"
                                                       Margin="8,4"
                                                       Height="1" />
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </GroupStyle.HeaderContainerStyle>
                    </GroupStyle>
                </controls:TopNavView.GroupStyle>
            </controls:TopNavView>
        </Grid>

        <controls:MenuButton x:Name="Photo"
                             Click="Photo_Click"
                             GettingFocus="ChatsList_GettingFocus"
                             Type="Back"
                             TabIndex="0"
                             HorizontalAlignment="Left"
                             VerticalAlignment="Center"
                             Width="48"
                             Height="40"
                             AutomationProperties.LandmarkType="Navigation"
                             AutomationProperties.Name="{CustomResource AccDescrOpenMenu}"
                             ToolTipService.ToolTip="{CustomResource AccDescrOpenMenu}"
                             Canvas.ZIndex="2"
                             Grid.ColumnSpan="2"
                             Grid.Row="0">
            <controls:MenuButton.Style>
                <Style TargetType="controls:MenuButton">
                    <Setter Property="Background"
                            Value="Transparent" />
                    <Setter Property="Foreground"
                            Value="{ThemeResource SystemControlForegroundBaseHighBrush}" />
                    <Setter Property="BorderBrush"
                            Value="{ThemeResource SystemControlForegroundBaseHighBrush}" />
                    <Setter Property="BorderThickness"
                            Value="0" />
                    <Setter Property="Padding"
                            Value="0" />
                    <Setter Property="HorizontalAlignment"
                            Value="Left" />
                    <Setter Property="HorizontalContentAlignment"
                            Value="Center" />
                    <Setter Property="VerticalAlignment"
                            Value="Top" />
                    <Setter Property="VerticalContentAlignment"
                            Value="Center" />
                    <Setter Property="FontFamily"
                            Value="{StaticResource SymbolThemeFontFamily}" />
                    <Setter Property="Height"
                            Value="48" />
                    <Setter Property="Width"
                            Value="40" />
                    <Setter Property="FontWeight"
                            Value="Normal" />
                    <Setter Property="FontSize"
                            Value="20" />
                    <Setter Property="UseSystemFocusVisuals"
                            Value="True" />
                    <Setter Property="FocusVisualMargin"
                            Value="-3" />
                    <Setter Property="CornerRadius"
                            Value="{StaticResource GlyphButtonCornerRadius}" />
                    <Setter Property="Template">
                        <Setter.Value>
                            <ControlTemplate TargetType="controls:MenuButton">
                                <Grid x:Name="RootGrid"
                                      Background="{TemplateBinding Background}"
                                      CornerRadius="{TemplateBinding CornerRadius}"
                                      Margin="{StaticResource GlyphButtonPadding}">
                                    <VisualStateManager.VisualStateGroups>
                                        <VisualStateGroup x:Name="CommonStates">
                                            <VisualState x:Name="Normal" />
                                            <VisualState x:Name="PointerOver">
                                                <Storyboard>
                                                    <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Background"
                                                                                   Storyboard.TargetName="RootGrid">
                                                        <DiscreteObjectKeyFrame KeyTime="0"
                                                                                Value="{ThemeResource SystemControlBackgroundListLowBrush}" />
                                                    </ObjectAnimationUsingKeyFrames>
                                                </Storyboard>
                                            </VisualState>
                                            <VisualState x:Name="Pressed">
                                                <Storyboard>
                                                    <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Background"
                                                                                   Storyboard.TargetName="RootGrid">
                                                        <DiscreteObjectKeyFrame KeyTime="0"
                                                                                Value="{ThemeResource SystemControlBackgroundListMediumBrush}" />
                                                    </ObjectAnimationUsingKeyFrames>
                                                </Storyboard>
                                            </VisualState>
                                            <VisualState x:Name="Disabled" />
                                            <VisualState x:Name="Checked" />
                                            <VisualState x:Name="CheckedPointerOver">
                                                <Storyboard>
                                                    <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Background"
                                                                                   Storyboard.TargetName="RootGrid">
                                                        <DiscreteObjectKeyFrame KeyTime="0"
                                                                                Value="{ThemeResource SystemControlBackgroundListLowBrush}" />
                                                    </ObjectAnimationUsingKeyFrames>
                                                </Storyboard>
                                            </VisualState>
                                            <VisualState x:Name="CheckedPressed">
                                                <Storyboard>
                                                    <ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Background"
                                                                                   Storyboard.TargetName="RootGrid">
                                                        <DiscreteObjectKeyFrame KeyTime="0"
                                                                                Value="{ThemeResource SystemControlBackgroundListMediumBrush}" />
                                                    </ObjectAnimationUsingKeyFrames>
                                                </Storyboard>
                                            </VisualState>
                                            <VisualState x:Name="CheckedDisabled" />
                                        </VisualStateGroup>
                                    </VisualStateManager.VisualStateGroups>

                                    <Border x:Name="LayoutRoot"
                                            Width="16"
                                            Height="16" />
                                </Grid>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </Style>
            </controls:MenuButton.Style>
        </controls:MenuButton>

        <controls:MasterDetailView x:Name="MasterDetail"
                                   ViewStateChanged="OnStateChanged"
                                   MasterVisibilityChanged="OnMasterVisibilityChanged"
                                   Grid.Column="1"
                                   Grid.Row="1">
            <controls:MasterDetailView.Banner>
                <Grid SizeChanged="Banner_SizeChanged">
                    <controls:PlaybackHeader x:Name="Playback"
                                             x:Load="False" />

                    <controls:GroupCallActiveHeader x:Load="False"
                                                    x:Name="CallBanner" />
                </Grid>
            </controls:MasterDetailView.Banner>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition />
                </Grid.RowDefinitions>
                <Grid x:Name="Header"
                      BorderBrush="Transparent"
                      Height="{StaticResource NavigationViewTopPaneHeight}"
                      Margin="0,-8,0,-8"
                      Canvas.ZIndex="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="40" />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>
                    <Grid x:Name="MainHeader"
                          Padding="12,0,0,0"
                          Grid.ColumnSpan="2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                            <ColumnDefinition Width="Auto"
                                              MinWidth="12" />
                        </Grid.ColumnDefinitions>
                        <controls:SuggestTextBox x:Name="SearchField"
                                                 PlaceholderText="{CustomResource Search}"
                                                 BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                                 Style="{StaticResource NoDeleteTextBoxStyle}"
                                                 AutomationProperties.LandmarkType="Search"
                                                 StartingIndex="1"
                                                 VerticalAlignment="Center"
                                                 GotFocus="Search_Click"
                                                 TextChanged="Search_TextChanged"
                                                 Grid.Column="1">
                            <!--<TextBox.Header>
                                <ItemsControl x:Name="Test"
                                              x:Load="False"
                                              ItemsSource="{x:Bind ViewModel.Chats.SearchFilters}"
                                              Margin="-4,0,0,0">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate x:DataType="collections:ISearchChatsFilter">
                                            <StackPanel Background="{ThemeResource SystemControlBackgroundAccentBrush}"
                                                        Orientation="Horizontal"
                                                        RequestedTheme="Dark"
                                                        Margin="8,4,-4,4"
                                                        CornerRadius="2">
                                                <TextBlock Text="{x:Bind Glyph}"
                                                           Margin="8,0,8,0"
                                                           FontSize="16"
                                                           FontFamily="{StaticResource SymbolThemeFontFamily}"
                                                           VerticalAlignment="Center" />
                                                <TextBlock Text="{x:Bind Text}"
                                                           TextWrapping="NoWrap"
                                                           TextTrimming="CharacterEllipsis"
                                                           Margin="0,0,8,0"
                                                           FontFamily="{ThemeResource EmojiThemeFontFamily}"
                                                           Style="{StaticResource BodyTextBlockStyle}"
                                                           VerticalAlignment="Center" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Horizontal" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                </ItemsControl>
                            </TextBox.Header>-->
                        </controls:SuggestTextBox>

                        <StackPanel x:Name="ChatsOptions"
                                    Orientation="Horizontal"
                                    VerticalAlignment="Center"
                                    Margin="-4,0,0,0"
                                    Grid.Column="2">
                            <controls:GlyphButton x:Name="ComposeButton"
                                                  Click="ComposeButton_Click"
                                                  Glyph="&#xE996;"
                                                  AutomationProperties.Name="{CustomResource NewConversationShortcut}"
                                                  ToolTipService.ToolTip="{CustomResource NewConversationShortcut}"
                                                  FontSize="16"
                                                  VerticalAlignment="Center"
                                                  Margin="-32,-4,0,-4"
                                                  Width="36"
                                                  Height="32" />
                            <controls:GlyphButton x:Name="Proxy"
                                                  Glyph="&#xEA19;"
                                                  Click="Proxy_Click"
                                                  Visibility="Collapsed"
                                                  FontFamily="{StaticResource TelegramThemeFontFamily}"
                                                  Style="{StaticResource HeaderGlyphButtonStyle}"
                                                  AutomationProperties.Name="{CustomResource ProxySettings}"
                                                  ToolTipService.ToolTip="{CustomResource ProxySettings}"
                                                  Width="40"
                                                  Height="40" />
                            <controls:GlyphButton x:Name="Lock"
                                                  Visibility="Collapsed"
                                                  Glyph="&#xE785;"
                                                  Click="Lock_Click"
                                                  Style="{StaticResource HeaderGlyphButtonStyle}"
                                                  AutomationProperties.Name="{CustomResource AccDescrPasscodeLock}"
                                                  ToolTipService.ToolTip="{CustomResource AccDescrPasscodeLock}"
                                                  Width="40"
                                                  Height="40" />
                        </StackPanel>
                    </Grid>
                </Grid>

                <Pivot x:Name="rpMasterTitlebar"
                       SelectionChanged="Pivot_SelectionChanged"
                       Style="{StaticResource HeaderlessPivotStyle}"
                       Margin="0,-72,0,0"
                       IsLocked="True"
                       Grid.Row="1">
                    <PivotItem Header="{CustomResource FilterChats}">
                        <Grid Margin="0,0,0,0">
                            <views:SearchChatsView x:Name="DialogsSearchPanel"
                                                   x:Load="False"
                                                   DataContext="{x:Bind ViewModel.SearchChats}"
                                                   ItemClick="ListView_ItemClick"
                                                   ItemContextRequested="DialogsSearchPanel_ItemContextRequested"
                                                   Margin="0,72,0,0" />
                            <Grid x:Name="DialogsPanel">
                                <Grid x:Name="ChatsPanel">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition />
                                    </Grid.RowDefinitions>
                                    <StackPanel x:Name="ChatListHeader"
                                                VerticalAlignment="Top"
                                                Spacing="60"
                                                Canvas.ZIndex="1">
                                        <Border Height="92" />

                                        <Border x:Name="ChatTabs"
                                                x:Load="False">
                                            <Grid x:Name="ChatTabsView">
                                                <controls:TopNavView x:Name="ChatFolders"
                                                                     AutomationProperties.Name="{CustomResource Filters}"
                                                                     ItemsSource="{x:Bind ViewModel.Folders}"
                                                                     SelectedItem="{x:Bind ViewModel.SelectedFolder, Mode=OneWay}"
                                                                     SelectionChanged="ChatFolders_SelectionChanged"
                                                                     ItemContextRequested="ChatFolder_ContextRequested"
                                                                     AllowDrop="True"
                                                                     CanDragItems="True"
                                                                     CanReorderItems="False"
                                                                     DragItemsStarting="ChatFolders_DragItemsStarting"
                                                                     DragItemsCompleted="ChatFolders_DragItemsCompleted"
                                                                     ScrollViewer.IsHorizontalScrollChainingEnabled="False"
                                                                     FocusFollowsSingleSelection="True"
                                                                     SingleSelectionFollowsFocus="False"
                                                                     Height="40">
                                                    <controls:TopNavView.ItemTemplate>
                                                        <DataTemplate x:DataType="viewModels:ChatFolderViewModel">
                                                            <StackPanel Orientation="Horizontal">
                                                                <TextBlock Text="{x:Bind Title, Mode=OneWay}"
                                                                           FontFamily="{ThemeResource EmojiThemeFontFamily}"
                                                                           VerticalAlignment="Bottom" />

                                                                <controls:BadgeControl Text="{x:Bind UnreadCount, Mode=OneWay}"
                                                                                       IsUnmuted="{x:Bind IsUnmuted, Mode=OneWay}"
                                                                                       Visibility="{x:Bind ShowCount, Mode=OneWay}"
                                                                                       VerticalAlignment="Bottom"
                                                                                       Margin="4,0,0,0" />
                                                            </StackPanel>
                                                        </DataTemplate>
                                                    </controls:TopNavView.ItemTemplate>
                                                    <controls:TopNavView.ItemContainerTransitions>
                                                        <TransitionCollection>
                                                            <AddDeleteThemeTransition />
                                                            <ContentThemeTransition />
                                                            <ReorderThemeTransition />
                                                            <RepositionThemeTransition />
                                                        </TransitionCollection>
                                                    </controls:TopNavView.ItemContainerTransitions>
                                                </controls:TopNavView>
                                            </Grid>
                                        </Border>
                                    </StackPanel>

                                    <controls:ChatListListView x:Name="ChatsList"
                                                               ItemClick="ListView_ItemClick"
                                                               IsItemClickEnabled="True"
                                                               AutomationProperties.LandmarkType="Main"
                                                               DataContext="{x:Bind ViewModel.Chats}"
                                                               ItemsSource="{x:Bind ViewModel.Chats.Items, Mode=OneWay}"
                                                               SelectionMode="{x:Bind ViewModel.Chats.SelectionMode, Mode=TwoWay}"
                                                               SelectionChanged="ListView_SelectionChanged"
                                                               ChoosingItemContainer="ChatsList_ChoosingItemContainer"
                                                               SizeChanged="ChatList_SizeChanged"
                                                               DragItemsStarting="Chats_DragItemsStarting"
                                                               DragItemsCompleted="Chats_DragItemsCompleted"
                                                               Swiped="ChatsList_Swiped"
                                                               GettingFocus="ChatsList_GettingFocus"
                                                               SingleSelectionFollowsFocus="False"
                                                               AllowDrop="True"
                                                               CanDragItems="True"
                                                               CanReorderItems="False"
                                                               Orientation="Vertical"
                                                               Grid.RowSpan="2">
                                        <ListView.Header>
                                            <StackPanel>
                                                <Grid>
                                                    <controls:SuggestedActionSetBirthdateCard x:Name="SetBirthdateCard"
                                                                                              x:Load="False"
                                                                                              Click="{x:Bind ViewModel.SetBirthdate}"
                                                                                              HideClick="{x:Bind ViewModel.HideBirthdate}" />
                                                    <controls:UnconfirmedSessionCard x:Name="UnconfirmedCard"
                                                                                     x:Load="False"
                                                                                     ConfirmClick="{x:Bind ViewModel.ConfirmSession}"
                                                                                     DenyClick="{x:Bind ViewModel.DenySession}" />
                                                </Grid>

                                                <Grid x:Name="ArchivedChatsPresenter">
                                                    <Border x:Name="ArchivedChatsPanel">
                                                        <Button Visibility="{x:Bind ArchivedChats.Visibility, Mode=OneWay}"
                                                                Click="ArchivedChats_Click"
                                                                ContextRequested="ArchivedChats_ContextRequested"
                                                                AutomationProperties.Name="{CustomResource ArchivedChats}"
                                                                Style="{StaticResource ListEmptyButtonStyle}"
                                                                Background="Transparent"
                                                                Padding="4,2"
                                                                CornerRadius="4">
                                                            <cells:ChatCell x:Name="ArchivedChats"
                                                                            Visibility="Collapsed"
                                                                            Stroke="{ThemeResource ChatLastMessageStateBrush}"
                                                                            SelectionStroke="{ThemeResource ApplicationPageBackgroundThemeBrush}"
                                                                            ActualThemeChanged="ArchivedChats_ActualThemeChanged" />
                                                        </Button>
                                                    </Border>
                                                    <!--<Border VerticalAlignment="Bottom">
                                                    <Border x:Name="ArchivedChatsCompactPanel"
                                                            Background="{ThemeResource PageBackgroundDarkBrush}">
                                                        <Button Click="ArchivedChats_Click"
                                                                Content="{CustomResource ArchivedChats}"
                                                                ContextRequested="ArchivedChats_ContextRequested"
                                                                Style="{StaticResource EmptyButtonStyle}"
                                                                Visibility="{x:Bind ArchivedChats.Visibility, Mode=OneWay}"
                                                                BorderThickness="12,6" />
                                                    </Border>
                                                </Border>-->
                                                </Grid>
                                            </StackPanel>
                                        </ListView.Header>
                                        <ListView.ItemTemplate>
                                            <DataTemplate>
                                                <cells:ChatCell StoryClick="ChatCell_StoryClick"
                                                                Stroke="{ThemeResource ChatLastMessageStateBrush}"
                                                                SelectionStroke="{ThemeResource ApplicationPageBackgroundThemeBrush}" />
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                        <ListView.ItemContainerTransitions>
                                            <TransitionCollection>
                                                <!-- Reordering items for some reason requires AddDeleteThemeTransition. -->
                                                <!-- https://github.com/microsoft/microsoft-ui-xaml/issues/3543 -->
                                                <!--<AddDeleteThemeTransition />
                                                    <ContentThemeTransition />
                                                    <ReorderThemeTransition />
                                                    <EntranceThemeTransition IsStaggeringEnabled="False" />-->
                                            </TransitionCollection>
                                        </ListView.ItemContainerTransitions>
                                    </controls:ChatListListView>

                                    <Grid x:Name="TopicListPresenter"
                                          x:Load="False"
                                          Margin="68,-78,0,0"
                                          Grid.Row="1">
                                        <Border Background="{ThemeResource SettingsItemBackground}"
                                                BorderBrush="{ThemeResource SettingsItemBorderBrush}"
                                                CornerRadius="{ThemeResource NavigationViewContentGridCornerRadius}"
                                                BorderThickness="{ThemeResource NavigationViewContentGridBorderThickness}"
                                                BackgroundSizing="InnerBorderEdge" />
                                        <controls:TopNavView x:Name="TopicList"
                                                             ItemsSource="{x:Bind ViewModel.Topics.Items}"
                                                             ChoosingItemContainer="TopicList_ChoosingItemContainer"
                                                             ContainerContentChanging="TopicList_ContainerContentChanging"
                                                             Orientation="Vertical"
                                                             IsItemClickEnabled="True"
                                                             ItemClick="ListView_ItemClick"
                                                             Style="{StaticResource DefaultListViewStyle}"
                                                             VerticalAlignment="Stretch"
                                                             Height="Auto">
                                            <ListView.ItemsPanel>
                                                <ItemsPanelTemplate>
                                                    <ItemsStackPanel />
                                                </ItemsPanelTemplate>
                                            </ListView.ItemsPanel>
                                            <ListView.ItemTemplate>
                                                <DataTemplate>
                                                    <cells:ForumTopicCell Stroke="{ThemeResource ChatLastMessageStateBrush}"
                                                                          SelectionStroke="{ThemeResource ApplicationPageBackgroundThemeBrush}" />
                                                </DataTemplate>
                                            </ListView.ItemTemplate>
                                        </controls:TopNavView>
                                    </Grid>

                                    <Grid x:Name="EmptyState"
                                          x:Load="{x:Bind ViewModel.Chats.Items.IsEmpty, Mode=OneWay}"
                                          Grid.Row="1">
                                        <Grid.RowDefinitions>
                                            <RowDefinition />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition Height="Auto" />
                                            <RowDefinition />
                                        </Grid.RowDefinitions>
                                        <controls:AnimatedImage Source="ms-appx:///Assets/Animations/EmptyFolder.tgs"
                                                                IsCachingEnabled="False"
                                                                LoopCount="1"
                                                                AutoPlay="True"
                                                                FrameSize="96,96"
                                                                DecodeFrameType="Logical"
                                                                VerticalAlignment="Top"
                                                                Width="96"
                                                                Height="96"
                                                                Margin="0,-96,0,0"
                                                                Grid.Row="1" />
                                        <TextBlock Text="{CustomResource FilterNoChatsToDisplay}"
                                                   Style="{StaticResource BaseTextBlockStyle}"
                                                   TextAlignment="Center"
                                                   Margin="12,16,12,4"
                                                   Grid.Row="2" />
                                        <TextBlock Text="{CustomResource FilterNoChatsToDisplayInfo}"
                                                   Style="{StaticResource InfoCaptionTextBlockStyle}"
                                                   TextAlignment="Center"
                                                   Margin="12,0,12,8"
                                                   Grid.Row="3" />

                                    </Grid>
                                </Grid>

                                <controls:DownloadsFooter x:Name="Downloads"
                                                          Click="Downloads_Click"
                                                          VerticalAlignment="Bottom"
                                                          Visibility="Collapsed"
                                                          Grid.Row="1" />

                                <Grid VerticalAlignment="Bottom"
                                      HorizontalAlignment="Center"
                                      Margin="12"
                                      Grid.Row="1">
                                    <Rectangle x:Name="UpdateShadow"
                                               HorizontalAlignment="Stretch"
                                               VerticalAlignment="Stretch"
                                               Fill="#2ca5e0"
                                               RadiusX="18"
                                               RadiusY="18" />
                                    <controls:BadgeButton x:Name="UpdateCloud"
                                                          Click="{x:Bind ViewModel.UpdateApp}"
                                                          Visibility="{x:Bind ViewModel.IsUpdateAvailable, Mode=OneWay}"
                                                          Content="{CustomResource UpdateTelegram}"
                                                          Style="{StaticResource StartButtonStyle}"
                                                          Padding="16,3,16,5"
                                                          CornerRadius="18"
                                                          Margin="0"
                                                          Height="36" />
                                </Grid>

                                <Grid x:Name="ManagePanel"
                                      Background="{ThemeResource PageSubHeaderBackgroundBrush2}"
                                      VerticalAlignment="Bottom"
                                      Margin="12,8"
                                      CornerRadius="15"
                                      Visibility="Collapsed"
                                      Grid.Row="1">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <Border BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                            BorderThickness="1"
                                            CornerRadius="15"
                                            Grid.ColumnSpan="8" />

                                    <controls:GlyphButton x:Name="ButtonManage"
                                                          CornerRadius="13,4,4,13"
                                                          Glyph="&#xE711;"
                                                          Click="Manage_Click" />

                                    <controls:AnimatedTextBlock x:Name="ManageCount"
                                                                Text="{x:Bind ViewModel.Chats.SelectedItems.Count, Mode=OneWay}"
                                                                TextStyle="{StaticResource BaseTextBlockStyle}"
                                                                VerticalAlignment="Center"
                                                                Margin="0,-2,0,0"
                                                                Grid.Column="1" />


                                    <controls:GlyphButton x:Name="ManageMute"
                                                          Click="{x:Bind ViewModel.Chats.NotifySelectedChats}"
                                                          Style="{StaticResource HeaderGlyphButtonStyle}"
                                                          VerticalAlignment="Center"
                                                          Grid.Column="3" />
                                    <controls:GlyphButton Glyph="&#xE7B8;"
                                                          Click="{x:Bind ViewModel.Chats.ArchiveSelectedChats}"
                                                          AutomationProperties.Name="{CustomResource Archive}"
                                                          ToolTipService.ToolTip="{CustomResource Archive}"
                                                          Style="{StaticResource HeaderGlyphButtonStyle}"
                                                          VerticalAlignment="Center"
                                                          Grid.Column="5" />
                                    <controls:GlyphButton Glyph="&#xE74D;"
                                                          Click="{x:Bind ViewModel.Chats.DeleteSelectedChats}"
                                                          AutomationProperties.Name="{CustomResource Delete}"
                                                          ToolTipService.ToolTip="{CustomResource Delete}"
                                                          Style="{StaticResource HeaderGlyphButtonStyle}"
                                                          VerticalAlignment="Center"
                                                          Grid.Column="6" />

                                    <controls:MoreButton CornerRadius="4,13,13,4"
                                                         Grid.Column="7">
                                        <controls:MoreButton.Flyout>
                                            <MenuFlyout Placement="TopEdgeAlignedRight">
                                                <MenuFlyoutItem x:Name="ManageMark"
                                                                Click="{x:Bind ViewModel.Chats.MarkSelectedChatsAsRead}" />
                                                <MenuFlyoutItem x:Name="ManageClear"
                                                                Text="{CustomResource ClearHistory}"
                                                                Click="{x:Bind ViewModel.Chats.ClearSelectedChats}">
                                                    <MenuFlyoutItem.Icon>
                                                        <FontIcon Glyph="&#xEA99;"
                                                                  FontFamily="{StaticResource SymbolThemeFontFamily}"
                                                                  FontSize="20" />
                                                    </MenuFlyoutItem.Icon>
                                                </MenuFlyoutItem>
                                            </MenuFlyout>
                                        </controls:MoreButton.Flyout>
                                    </controls:MoreButton>
                                </Grid>
                            </Grid>
                        </Grid>
                    </PivotItem>
                    <PivotItem Header="{CustomResource Settings}">
                        <Grid x:Name="SettingsRoot"
                              x:Load="False"
                              Margin="0,80,0,0">
                            <ListView ItemsSource="{x:Bind ViewModel.Settings.Results}"
                                      SelectionMode="None"
                                      ContainerContentChanging="Settings_ContainerContentChanging"
                                      Grid.Row="1">
                                <ListView.ItemContainerStyle>
                                    <Style TargetType="ListViewItem">
                                        <Setter Property="HorizontalContentAlignment"
                                                Value="Stretch" />
                                        <Setter Property="Padding"
                                                Value="0" />
                                    </Style>
                                </ListView.ItemContainerStyle>
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <controls:BadgeButton Style="{StaticResource IconSubbadgeBadgeButtonStyle}" />
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>

                            <local:SettingsPage x:Name="SettingsView"
                                                MasterDetail="{x:Bind MasterDetail}" />
                        </Grid>
                    </PivotItem>
                </Pivot>

                <stories:StoriesStrip x:Name="Stories"
                                      Expanding="Stories_Expanding"
                                      DataContext="{x:Bind ViewModel.Stories}"
                                      ControlledList="{x:Bind ChatsList}"
                                      ChatTabs="{x:Bind ChatTabs, Mode=OneWay}"
                                      TitleBarrr="{x:Bind TitleBarrr}"
                                      Header="{x:Bind Header}"
                                      VerticalAlignment="Top"
                                      Margin="0,-32,0,0"
                                      Grid.RowSpan="2" />
            </Grid>
        </controls:MasterDetailView>

        <controls:ConfettiView x:Name="Confetti"
                               x:Load="False"
                               IsHitTestVisible="False"
                               Grid.ColumnSpan="2"
                               Grid.Row="1" />
        <!--Completed="Confetti_Completed"-->
    </Grid>
</controls:CorePage>
