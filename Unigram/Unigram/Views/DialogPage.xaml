<Page
    x:Class="Unigram.Views.DialogPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="using:Unigram.Controls"
    xmlns:local="using:Unigram.Views"
    xmlns:vm="using:Unigram.ViewModels"
    xmlns:vmc="using:Telegram.Api.TL"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d">

    <Page.Transitions>
        <TransitionCollection>
            <NavigationThemeTransition>
                <ContinuumNavigationTransitionInfo />
            </NavigationThemeTransition>
        </TransitionCollection>
    </Page.Transitions>

    <Grid Background="{ThemeResource ApplicationPageBackgroundThemeBrush}">
        <Grid.RowDefinitions>
            <RowDefinition Height="48" />
            <RowDefinition />
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Titlebar -->
        <Button x:Name="btnDialogInfo"
                Background="{ThemeResource TelegramBackgroundTitlebarBrush}"
                HorizontalAlignment="Stretch"
                VerticalAlignment="Stretch"
                HorizontalContentAlignment="Stretch"
                Padding="0"
                Grid.Row="0" Click="btnDialogInfo_Click">
            <Button.Content>
                <StackPanel Orientation="Horizontal">
                    <!--User icon-->
                    <Ellipse x:Name="elpDialogIcon"
                             Width="40"
                             Height="40"
                             Margin="12,0">
                        <Ellipse.Fill>
                            <ImageBrush ImageSource="ms-appx:///Assets/Mockups/UserIcons/user_batman.png" />
                        </Ellipse.Fill>
                    </Ellipse>
                    <StackPanel Orientation="Vertical"
                                VerticalAlignment="Center">
                        <TextBlock x:Name="tblDialogName"
                                   Text="{x:Bind Path=ViewModel.DialogTitle}"
                                   FontSize="16"
                                   Style="{StaticResource BaseTextBlockStyle}"/>
                        <TextBlock x:Name="tblDialogStatus"
                                   Foreground="{StaticResource SystemControlForegroundBaseMediumBrush}"
                                   FontSize="12"
                                   Text="Online" />
                    </StackPanel>
                </StackPanel>
            </Button.Content>
        </Button>
        <!-- END OF Titlebar -->
        
        <!-- Main content -->
        <RelativePanel Grid.Row="1">
            <!--<GridView x:Name="lvDialogs"
                      ItemsSource="{x:Bind Path=ViewModel.ListX}"
                      RelativePanel.AlignLeftWithPanel="True"
                      RelativePanel.AlignRightWithPanel="True"
                      RelativePanel.AlignTopWithPanel="True"
                      RelativePanel.Above="rpInput">
                <GridView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <ItemsStackPanel GroupHeaderPlacement="Left"
                                         ItemsUpdatingScrollMode="KeepLastItemInView"
                                         VerticalAlignment="Bottom" />
                    </ItemsPanelTemplate>
                </GridView.ItemsPanel>
            </GridView>-->
            <Grid
                RelativePanel.AlignLeftWithPanel="True"
                      RelativePanel.AlignRightWithPanel="True"
                      RelativePanel.AlignTopWithPanel="True"
                      RelativePanel.Above="rpInput">
                <controls:BubbleListView x:Name="lvDialogs" ItemsSource="{x:Bind ViewModel.ListX}" >                    
                    <ListView.ItemsPanel>
                        <ItemsPanelTemplate>
                            <ItemsStackPanel GroupHeaderPlacement="Left"
                                             ItemsUpdatingScrollMode="KeepLastItemInView"
                                             VerticalAlignment="Bottom" />
                        </ItemsPanelTemplate>
                    </ListView.ItemsPanel>
                    <ListView.ItemTemplate>
                        <DataTemplate x:DataType="vmc:TLMessage">
                            <Border Background="{StaticResource TelegramBackgroundMessageBubbleBrush}"
                                    Margin="8"
                                    MinHeight="36"
                                    MinWidth="200"
                                    MaxWidth="450">
                                <StackPanel Orientation="Vertical"
                                            Padding="8,6">
                                    <Image Margin="0,0,0,6"
                                           Visibility="Collapsed"
                                           Source="ms-appx:///Assets/Mockups/Images/userPhoto.jpg"/>
                                    <TextBlock Text="{x:Bind Message, Mode=OneWay, FallbackValue='message'}"
                                               TextWrapping="Wrap"
                                               RequestedTheme="Dark"/>
                                    <TextBlock Text="{x:Bind FromId, Mode=OneWay, FallbackValue='from id'}"
                                               Visibility="Collapsed"
                                               TextWrapping="Wrap"
                                               Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}"
                                               RequestedTheme="Dark"/>
                                    <StackPanel Orientation="Horizontal" 
                                                HorizontalAlignment="Right">
                                        <FontIcon x:Name="StateIcon"
                                                  Visibility="Collapsed"
                                                  Glyph="&#xE601;" 
                                                  FontFamily="{ThemeResource TelegramThemeFontFamily}"
                                                  Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" 
                                                  FontSize="10" 
                                                  Height="10"
                                                  Width="18"
                                                  Margin="0,0,4,0"/>
                                        <TextBlock Text="{x:Bind Date, Mode=OneWay, FallbackValue='date'}"
                                                   RequestedTheme="Dark"
                                                   Style="{ThemeResource CaptionTextBlockStyle}" />
                                    </StackPanel>
                                </StackPanel>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </controls:BubbleListView>
            </Grid>
            
            <!-- Input pane -->
            <RelativePanel x:Name="rpInput"
                           MinHeight="48"
                           BorderThickness="0,2,0,0"
                           BorderBrush="{ThemeResource TelegramBackgroundAccentBrush}"
                           Visibility="Visible"
                           RelativePanel.AlignLeftWithPanel="True"
                           RelativePanel.AlignRightWithPanel="True"
                           RelativePanel.AlignBottomWithPanel="True">
                <!-- Message input -->
                <TextBox x:Name="txtMessage" 
                         x:Uid="Chat-Input-Message"
                         PlaceholderText="Type your message..."
                         Text="{Binding SendTextHolder, Mode=TwoWay}"
                         BorderThickness="0" 
                         Padding="14" 
                         TextWrapping="Wrap" 
                         InputScope="Text" 
                         IsSpellCheckEnabled="True"
                         VerticalAlignment="Bottom" 
                         VerticalContentAlignment="Bottom"
                         MinHeight="48"
                         MaxHeight="84"
                         AcceptsReturn="True"
                         TextChanging="txtMessage_TextChanging"
                         RelativePanel.AlignLeftWithPanel="True"
                         RelativePanel.AlignBottomWithPanel="True"
                         RelativePanel.LeftOf="btnSendMessage" />
                <!-- Send-button -->
                <Button x:Name="btnSendMessage"  
                        Visibility="Visible"
                        IsEnabled="True"
                        Width="48"
                       Command="{Binding SendCommand}"
                        MinHeight="48" 
                        Background="{ThemeResource TelegramBackgroundAccentBrush}"                                      
                        VerticalAlignment="Stretch"
                        ScrollViewer.VerticalScrollBarVisibility="Disabled"
                        RelativePanel.AlignTopWithPanel="True"
                        RelativePanel.AlignBottomWithPanel="True"
                        RelativePanel.AlignRightWithPanel="True" Click="btnSendMessage_Click">
                    <Button.Content>
                        <TextBlock FontFamily="Segoe MDL2 Assets" 
                                   FontSize="20"
                                   Text="&#xE122;"
                                   RequestedTheme="Dark"/>
                    </Button.Content>
                </Button>

                <!-- Voice Record-button -->
                <Button x:Name="btnVoiceMessage"
                        Visibility="Collapsed"
                        Width="48"
                        MinHeight="48" 
                        Background="Transparent"                                      
                        VerticalAlignment="Stretch"
                        ScrollViewer.VerticalScrollBarVisibility="Disabled"
                        RelativePanel.AlignTopWithPanel="True"
                        RelativePanel.AlignBottomWithPanel="True"                        
                        RelativePanel.AlignRightWithPanel="True" Click="btnVoiceMessage_Click">
                    <Button.Content>
                        <TextBlock FontFamily="Segoe MDL2 Assets" 
                                   FontSize="20"
                                   Text="&#xE720;"
                                   RequestedTheme="Dark"/>
                    </Button.Content>
                </Button>
            </RelativePanel>
        </RelativePanel>
        <!-- END OF Main content -->        
        
        <!-- Commandbar -->
        <CommandBar x:Name="commandbar"
                    Grid.Row="2">
            <!-- Primary commands (visible in bar) -->
            <CommandBar.PrimaryCommands>
                <AppBarButton x:Name="cbtnAttachment"
                              x:Uid="CBTN-Attachment"
                              Icon="Attach"
                              Label="Attachment">
                    <!-- Attachment options -->
                    <AppBarButton.Flyout>
                        <MenuFlyout>
                            <!-- Please try to add camera capabilities with the W10 file picker first
                                        if that's not possible for all platforms, then enable the Camera-button here and 
                                            write something for that -->
                            <!--<MenuFlyoutItem x:Name="fcbtnAttachCamera"
                                                x:Uid="FCBTN-Camera"
                                                Text="Camera" />-->
                            <MenuFlyoutItem x:Name="fcbtnAttachPhoto"
                                            x:Uid="FCBTN-Photo"
                                            Text="Photo" 
                                            MinWidth="180"/>
                            <MenuFlyoutItem x:Name="fcbtnAttachVideo"
                                            x:Uid="FCBTN-Video"
                                            Text="Video" />
                            <MenuFlyoutItem x:Name="fcbtnAttachLocation"
                                            x:Uid="FCBTN-Location"
                                            Text="Location" />
                            <MenuFlyoutItem x:Name="fcbtnAttachFile"
                                            x:Uid="FCBTN-File"
                                            Text="File" />
                            <MenuFlyoutItem x:Name="fcbtnAttachContact"
                                            x:Uid="FCBTN-Contact"
                                            Text="Contact" />
                        </MenuFlyout>
                    </AppBarButton.Flyout>
                </AppBarButton>
                <AppBarButton x:Name="cbtnStickers"
                              x:Uid="CBTN-Stickers"
                              Icon="Emoji2"
                              Label="Stickers" />
            </CommandBar.PrimaryCommands>

            <!-- Secondary Commands (hidden in sub menu) -->
            <CommandBar.SecondaryCommands>
                <AppBarButton x:Name="cbtnReportSpam"
                              x:Uid="CBTN-ReportSpam"
                              Icon="ReportHacked"
                              Label="Report spam" />
                <AppBarButton x:Name="cbtnSearch"
                              x:Uid="CBTN-Search"
                              Icon="Find"
                              Label="Search" />
                <AppBarButton x:Name="cbtnPinToStart"
                              x:Uid="CBTN-Pin"
                              Icon="Pin"
                              Label="Pin to Start"/>
            </CommandBar.SecondaryCommands>
        </CommandBar>
        <!-- END OF - Commandbar -->

    </Grid>
</Page>
