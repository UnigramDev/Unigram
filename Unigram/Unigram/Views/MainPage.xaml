<Page x:Class="Unigram.Views.MainPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:local="using:Unigram.Views"
      xmlns:controls="using:Unigram.Controls"
      xmlns:collections="using:Unigram.Collections"
      xmlns:selectors="using:Unigram.Selectors"
      xmlns:cells="using:Unigram.Controls.Cells"
      xmlns:chats="using:Unigram.Controls.Chats"
      xmlns:viewModels="using:Unigram.ViewModels"
      xmlns:muxc="using:Microsoft.UI.Xaml.Controls"
      xmlns:navigation="using:Unigram.Navigation.Services"
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
      mc:Ignorable="d"
      Loaded="OnLoaded"
      Unloaded="OnUnloaded">

    <Page.Transitions>
        <TransitionCollection>
            <NavigationThemeTransition>
                <SuppressNavigationTransitionInfo />
            </NavigationThemeTransition>
        </TransitionCollection>
    </Page.Transitions>

    <Page.Resources>
        <CollectionViewSource x:Name="NavigationResults"
                              Source="{x:Bind ViewModel.NavigationItems}"
                              IsSourceGrouped="True" />

        <CollectionViewSource x:Name="ChatsResults"
                              Source="{x:Bind ViewModel.Chats.Search, Mode=OneWay}"
                              IsSourceGrouped="True" />
        <CollectionViewSource x:Name="ContactsResults"
                              Source="{x:Bind ViewModel.Contacts.Search, Mode=OneWay}"
                              IsSourceGrouped="True" />

        <Style TargetType="controls:MasterDetailView">
            <Setter Property="IsTabStop"
                    Value="False" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="controls:MasterDetailView">
                        <controls:MasterDetailPanel x:Name="AdaptivePanel"
                                                    Background="Transparent">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup x:Name="CommonStates">
                                    <VisualState x:Name="Expanded" />
                                    <VisualState x:Name="Minimal">
                                        <VisualState.Setters>
                                            <Setter Target="BackgroundPart.CornerRadius"
                                                    Value="0" />
                                            <Setter Target="DetailHeaderPresenter2.CornerRadius"
                                                    Value="0" />
                                            <Setter Target="BorderPart.CornerRadius"
                                                    Value="0" />
                                            <Setter Target="BorderPart.BorderThickness"
                                                    Value="0" />
                                        </VisualState.Setters>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>
                            <chats:ChatBackgroundPresenter x:Name="BackgroundPart"
                                                           CornerRadius="{ThemeResource NavigationViewContentGridCornerRadius}"
                                                           Background="{ThemeResource ChatPageBackgroundBrush}"
                                                           Opacity="{TemplateBinding BackgroundOpacity}"
                                                           Loading="ChatBackgroundPresenter_Loading" />

                            <!--<Grid BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding Padding}" VerticalAlignment="Top"/>-->

                            <Grid Canvas.ZIndex="1">
                                <ContentControl x:Name="DetailHeaderPresenter2"
                                                Content="{TemplateBinding DetailHeader}"
                                                CornerRadius="{ThemeResource NavigationViewContentGridCornerRadius}"
                                                IsTabStop="False"
                                                HorizontalContentAlignment="Stretch"
                                                VerticalContentAlignment="Stretch"
                                                VerticalAlignment="Top"
                                                Canvas.ZIndex="1">
                                    <ContentControl.Template>
                                        <ControlTemplate TargetType="ContentControl">
                                            <ContentPresenter CornerRadius="{TemplateBinding CornerRadius}" />
                                        </ControlTemplate>
                                    </ContentControl.Template>
                                </ContentControl>
                                <Grid Margin="24,0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition MaxWidth="1000" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <muxc:BreadcrumbBar x:Name="DetailHeaderPresenter"
                                                        Margin="0,-4,0,0"
                                                        VerticalAlignment="Top">
                                        <muxc:BreadcrumbBar.ItemTemplate>
                                            <DataTemplate x:DataType="navigation:NavigationStackItem">
                                                <!--<TextBlock Text="{x:Bind Title}" />-->
                                                <muxc:BreadcrumbBarItem Content="{x:Bind Title, Mode=OneWay}" />
                                            </DataTemplate>
                                        </muxc:BreadcrumbBar.ItemTemplate>
                                    </muxc:BreadcrumbBar>

                                    <ContentControl Content="{TemplateBinding DetailFooter}"
                                                    IsTabStop="False"
                                                    HorizontalContentAlignment="Right"
                                                    VerticalContentAlignment="Stretch"
                                                    VerticalAlignment="Top"
                                                    Canvas.ZIndex="1" />
                                </Grid>
                            </Grid>

                            <ContentControl Content="{TemplateBinding Banner}"
                                            IsTabStop="False"
                                            HorizontalContentAlignment="Stretch"
                                            VerticalContentAlignment="Stretch"
                                            VerticalAlignment="Top"
                                            Canvas.ZIndex="1" />

                            <Grid x:Name="DetailPresenter" />

                            <Border x:Name="BorderPart"
                                    Opacity="{TemplateBinding BackgroundOpacity}"
                                    BorderBrush="{ThemeResource NavigationViewContentGridBorderBrush}"
                                    BorderThickness="{ThemeResource NavigationViewContentGridBorderThickness}"
                                    CornerRadius="{ThemeResource NavigationViewContentGridCornerRadius}"
                                    Canvas.ZIndex="1" />

                            <ContentPresenter x:Name="MasterFrame"
                                              Content="{TemplateBinding Content}"
                                              ContentTemplate="{TemplateBinding ContentTemplate}"
                                              ContentTemplateSelector="{TemplateBinding ContentTemplateSelector}"
                                              ContentTransitions="{TemplateBinding ContentTransitions}"
                                              HorizontalContentAlignment="Stretch"
                                              VerticalContentAlignment="Stretch" />

                            <UserControl Canvas.ZIndex="2">
                                <Border x:Name="Grip"
                                        Width="12"
                                        Background="Transparent"
                                        BorderBrush="Transparent"
                                        BorderThickness="0,0,6,0">
                                    <VisualStateManager.VisualStateGroups>
                                        <VisualStateGroup>
                                            <VisualState x:Name="Normal" />
                                            <VisualState x:Name="Pressed">
                                                <VisualState.Setters>
                                                    <Setter Target="Grip.Background"
                                                            Value="{ThemeResource ScrollBarThumbBackground}" />
                                                </VisualState.Setters>
                                            </VisualState>
                                        </VisualStateGroup>
                                    </VisualStateManager.VisualStateGroups>
                                </Border>
                            </UserControl>
                        </controls:MasterDetailPanel>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Page.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition />
        </Grid.ColumnDefinitions>

        <Grid x:Name="TitleBarrr"
              Height="40"
              Background="Transparent"
              Grid.ColumnSpan="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="52" />
                <ColumnDefinition />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <muxc:ProgressBar x:Name="State"
                              VerticalAlignment="Top"
                              Background="Transparent"
                              Grid.ColumnSpan="4" />
            <Canvas x:Name="TitleBarLogo"
                    Width="16"
                    Height="14"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Center"
                    Grid.Column="1">
                <Path Data="M14.6025 0.109437C9.96891 1.86558 5.33409 3.61851 0.69863 5.36857L0.69863 5.36857C0.391755 5.48441 0.151119 5.65913 0.0247189 5.96984L0.0247189 5.96984C-0.00823964 6.06584 -0.00823964 6.14328 0.0247189 6.21976L0.0247189 6.21976C0.169358 6.5228 0.426634 6.67031 0.735112 6.77303L0.735112 6.77303C1.51366 7.03255 2.29669 7.28279 3.0586 7.58486L3.0586 7.58486C3.77315 7.8687 4.38978 7.77046 5.0301 7.35575L5.0301 7.35575C7.12511 5.99896 9.23964 4.67322 11.3497 3.34011L11.3497 3.34011C11.5299 3.22651 11.7417 2.98396 11.9478 3.23324L11.9478 3.23324C12.1769 3.51067 11.8617 3.65819 11.7062 3.80859L11.7062 3.80859C10.158 5.30617 8.60157 6.79479 7.05087 8.28949L7.05087 8.28949C6.55616 8.76629 6.57984 9.14804 7.12959 9.54644L7.12959 9.54644C8.67037 10.6648 10.2121 11.781 11.7619 12.8869L11.7619 12.8869C11.9414 13.0152 12.165 13.1211 12.381 13.1531L12.381 13.1531C12.9948 13.2437 13.4037 12.8773 13.5663 12.1429L13.5663 12.1429C13.7676 11.2299 13.9692 10.3167 14.1692 9.4034L14.1692 9.4034C14.7685 6.66327 15.3653 3.92219 15.9685 1.18303L15.9685 1.18303C16.0463 0.82847 15.9852 0.522555 15.7272 0.264637L15.7272 0.264637C15.5365 0.0742392 15.3317 0 15.1148 0L15.1148 0C14.9506 0 14.7794 0.0425605 14.6025 0.109439"
                      StrokeThickness="0"
                      Stroke="#00000000">
                    <Path.Fill>
                        <LinearGradientBrush StartPoint="0.355035215616226,0"
                                             EndPoint="0.916017889976501,0.0104505941271782"
                                             MappingMode="RelativeToBoundingBox">
                            <LinearGradientBrush.GradientStops>
                                <GradientStopCollection>
                                    <GradientStop Offset="0"
                                                  Color="#008ED4" />
                                    <GradientStop Offset="1"
                                                  Color="#25AEF3" />
                                </GradientStopCollection>
                            </LinearGradientBrush.GradientStops>
                        </LinearGradientBrush>
                    </Path.Fill>
                </Path>
                <Path Data="M14.6025 0.109437C9.96891 1.86558 5.33409 3.61851 0.69863 5.36857L0.69863 5.36857C0.391755 5.48441 0.151119 5.65913 0.0247189 5.96984L0.0247189 5.96984C-0.00823964 6.06584 -0.00823964 6.14328 0.0247189 6.22008L0.0247189 6.22008C0.169358 6.52248 0.426634 6.67031 0.735112 6.77303L0.735112 6.77303C1.51366 7.03255 2.29669 7.28279 3.0586 7.58486L3.0586 7.58486C3.33316 7.69398 3.59332 7.74646 3.84547 7.74646L3.84547 7.74646C4.25059 7.74646 4.63554 7.6111 5.0301 7.35575L5.0301 7.35575C7.12511 5.99896 9.23964 4.67322 11.3497 3.34012L11.3497 3.34012C11.4729 3.26236 11.6105 3.12444 11.7516 3.12444L11.7516 3.12444C11.8166 3.12444 11.8825 3.1542 11.9478 3.23323L11.9478 3.23323C12.1775 3.51067 11.8617 3.65819 11.7062 3.80858L11.7062 3.80858C10.158 5.30617 8.60157 6.79479 7.05087 8.28949L7.05087 8.28949C6.55616 8.76629 6.57984 9.14804 7.12959 9.54644L7.12959 9.54644C8.67037 10.6648 10.2121 11.781 11.7619 12.8869L11.7619 12.8869C11.9414 13.0152 12.165 13.1211 12.381 13.1531L12.381 13.1531C12.4425 13.1624 12.5017 13.1666 12.559 13.1666L12.559 13.1666C13.0742 13.1666 13.4204 12.8037 13.5663 12.1429L13.5663 12.1429C13.7676 11.2299 13.9692 10.3167 14.1692 9.4034L14.1692 9.4034C14.7685 6.66327 15.3653 3.92219 15.9685 1.18303L15.9685 1.18303C16.0463 0.828471 15.9852 0.522555 15.7272 0.264637L15.7272 0.264637C15.5365 0.0742392 15.3317 0 15.1148 0L15.1148 0C14.9503 0 14.7794 0.0425605 14.6025 0.109439M3.17668 7.28759C2.52613 7.02935 1.85382 6.80663 1.2039 6.59127L1.2039 6.59127L0.836229 6.46967C0.558793 6.3772 0.408394 6.26872 0.320717 6.09688L0.320717 6.09688C0.321676 6.09336 0.322636 6.08824 0.324877 6.0812L0.324877 6.0812C0.405834 5.88984 0.552073 5.766 0.811909 5.66808L0.811909 5.66808C5.44737 3.91771 10.0825 2.16509 14.7161 0.408632L14.7161 0.408632C14.8738 0.349113 15.0044 0.319992 15.1148 0.319992L15.1148 0.319992C15.2636 0.319992 15.3823 0.372792 15.5007 0.490869L15.5007 0.490869C15.6687 0.658868 15.7151 0.845106 15.6556 1.1139L15.6556 1.1139C15.2357 3.023 14.8188 4.93274 14.4012 6.84247L14.4012 6.84247L13.8565 9.33524C13.6569 10.2482 13.4553 11.1611 13.2537 12.0738L13.2537 12.0738C13.0831 12.8469 12.6889 12.8469 12.559 12.8469L12.559 12.8469C12.5174 12.8469 12.4732 12.8434 12.4278 12.8366L12.4278 12.8366C12.279 12.8149 12.1042 12.7378 11.9474 12.6264L11.9474 12.6264C10.4844 11.5822 9.03836 10.5368 7.31743 9.28788L7.31743 9.28788C7.13087 9.15252 7.02463 9.02484 7.01823 8.92852L7.01823 8.92852C7.01119 8.82997 7.10175 8.68501 7.27295 8.51989L7.27295 8.51989C7.89694 7.91862 8.52189 7.31831 9.14685 6.71767L9.14685 6.71767C10.0748 5.82552 11.0035 4.9337 11.9286 4.03835L11.9286 4.03835C11.9516 4.01659 11.9791 3.99451 12.007 3.97211L12.007 3.97211C12.1321 3.87099 12.3212 3.71867 12.3462 3.47195L12.3462 3.47195C12.3615 3.31868 12.3106 3.16988 12.1942 3.02908L12.1942 3.02908C12.0409 2.8438 11.8684 2.80444 11.7516 2.80444L11.7516 2.80444C11.5427 2.80444 11.3785 2.92508 11.2591 3.01308L11.2591 3.01308C11.2316 3.03324 11.2047 3.0534 11.1788 3.06972L11.1788 3.06972L9.99803 3.81499C8.30878 4.88058 6.56192 5.98232 4.85634 7.08695L4.85634 7.08695C4.49858 7.31894 4.17763 7.42646 3.84547 7.42646L3.84547 7.42646C3.6314 7.42646 3.41252 7.38102 3.17668 7.28759"
                      StrokeThickness="0"
                      Stroke="#00000000">
                    <Path.Fill>
                        <LinearGradientBrush StartPoint="4.80645803691004E-06,0.5"
                                             EndPoint="0.9999920129776,0.5"
                                             MappingMode="RelativeToBoundingBox">
                            <LinearGradientBrush.GradientStops>
                                <GradientStopCollection>
                                    <GradientStop Offset="0"
                                                  Color="#008ED4" />
                                    <GradientStop Offset="0.303017"
                                                  Color="#008ED4" />
                                    <GradientStop Offset="0.9"
                                                  Color="#25AEF3" />
                                    <GradientStop Offset="1"
                                                  Color="#25AEF3" />
                                </GradientStopCollection>
                            </LinearGradientBrush.GradientStops>
                        </LinearGradientBrush>
                    </Path.Fill>
                </Path>
            </Canvas>

            <TextBlock x:Name="StateLabel"
                       VerticalAlignment="Center"
                       TextLineBounds="TrimToCapHeight"
                       AutomationProperties.LiveSetting="Assertive"
                       Foreground="{ThemeResource PageHeaderForegroundBrush}"
                       Style="{StaticResource CaptionTextBlockStyle}"
                       Margin="0,2,6,0"
                       Grid.Column="2" />
        </Grid>

        <Grid x:Load="False"
              x:Name="ChatTabsLeft"
              Grid.Row="1">
            <Grid.RowDefinitions>
                <RowDefinition />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <controls:TopNavView x:Name="ChatFiltersSide"
                                 ItemsSource="{x:Bind NavigationResults.View}"
                                 SelectedItem="{x:Bind ConvertFilter(ViewModel.SelectedFilter), Mode=TwoWay, BindBack=ConvertFilterBack}"
                                 IsItemClickEnabled="True"
                                 ItemClick="ChatFilter_ItemClick"
                                 ItemContextRequested="ChatFilter_ContextRequested"
                                 ChoosingGroupHeaderContainer="ChatFilters_ChoosingGroupHeaderContainer"
                                 Orientation="Vertical"
                                 AllowDrop="True"
                                 CanDragItems="True"
                                 CanReorderItems="False"
                                 DragItemsStarting="ChatFilters_DragItemsStarting"
                                 DragItemsCompleted="ChatFilters_DragItemsCompleted"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                                 ScrollViewer.HorizontalScrollMode="Disabled"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 ScrollViewer.VerticalScrollMode="Auto"
                                 Height="Auto"
                                 Width="68">
                <controls:TopNavView.ItemTemplate>
                    <DataTemplate>
                        <cells:ChatFilterCell />
                    </DataTemplate>
                </controls:TopNavView.ItemTemplate>
                <controls:TopNavView.ItemsPanel>
                    <ItemsPanelTemplate>
                        <ItemsStackPanel Orientation="Vertical" />
                    </ItemsPanelTemplate>
                </controls:TopNavView.ItemsPanel>
                <controls:TopNavView.ItemContainerStyle>
                    <Style TargetType="controls:TopNavViewItem">
                        <Setter Property="HorizontalAlignment"
                                Value="Stretch" />
                        <Setter Property="VerticalAlignment"
                                Value="Stretch" />
                        <Setter Property="HorizontalContentAlignment"
                                Value="Stretch" />
                        <Setter Property="VerticalContentAlignment"
                                Value="Stretch" />
                        <Setter Property="UseSystemFocusVisuals"
                                Value="True" />
                        <Setter Property="Margin"
                                Value="0,0,0,4" />
                        <Setter Property="Template">
                            <Setter.Value>
                                <ControlTemplate TargetType="controls:TopNavViewItem">
                                    <Grid Background="Transparent">
                                        <VisualStateManager.CustomVisualStateManager>
                                            <controls:TopNavViewItemManager />
                                        </VisualStateManager.CustomVisualStateManager>
                                        <VisualStateManager.VisualStateGroups>
                                            <VisualStateGroup x:Name="CommonStates">
                                                <VisualState x:Name="Normal" />
                                                <VisualState x:Name="PointerOver">
                                                    <VisualState.Setters>
                                                        <Setter Target="Plate.Background"
                                                                Value="{ThemeResource ControlAltFillColorQuarternaryBrush}" />
                                                    </VisualState.Setters>
                                                </VisualState>
                                                <VisualState x:Name="Pressed">
                                                    <VisualState.Setters>
                                                        <Setter Target="Plate.Background"
                                                                Value="{ThemeResource ControlAltFillColorTertiaryBrush}" />
                                                    </VisualState.Setters>
                                                </VisualState>
                                                <VisualState x:Name="Selected">
                                                    <VisualState.Setters>
                                                        <Setter Target="Plate.Background"
                                                                Value="{ThemeResource ControlSolidFillColorDefaultBrush}" />
                                                    </VisualState.Setters>
                                                </VisualState>
                                                <VisualState x:Name="PointerOverSelected">
                                                    <VisualState.Setters>
                                                        <Setter Target="Plate.Background"
                                                                Value="{ThemeResource ControlSolidFillColorDefaultBrush}" />
                                                    </VisualState.Setters>
                                                </VisualState>
                                                <VisualState x:Name="PressedSelected">
                                                    <VisualState.Setters>
                                                        <Setter Target="Plate.Background"
                                                                Value="{ThemeResource ControlSolidFillColorDefaultBrush}" />
                                                    </VisualState.Setters>
                                                </VisualState>
                                            </VisualStateGroup>
                                        </VisualStateManager.VisualStateGroups>
                                        <Border x:Name="Plate"
                                                Width="64"
                                                Margin="4,0,0,0"
                                                CornerRadius="4" />
                                        <ContentPresenter x:Name="ContentPresenter"
                                                          Grid.Column="1"
                                                          Margin="0"
                                                          TextWrapping="NoWrap"
                                                          Foreground="{TemplateBinding Foreground}"
                                                          ContentTransitions="{TemplateBinding ContentTransitions}"
                                                          ContentTemplate="{TemplateBinding ContentTemplate}"
                                                          Content="{TemplateBinding Content}"
                                                          HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                          ContentTemplateSelector="{TemplateBinding ContentTemplateSelector}"
                                                          VerticalAlignment="Center"
                                                          AutomationProperties.AccessibilityView="Raw" />
                                        <Grid x:Name="SelectionIndicatorGrid"
                                              Margin="4,4,0,4"
                                              HorizontalAlignment="Left"
                                              VerticalAlignment="Center">
                                            <Rectangle x:Name="SelectionIndicator"
                                                       Width="3"
                                                       Height="24"
                                                       Fill="{ThemeResource NavigationViewSelectionIndicatorForeground}"
                                                       Opacity="0"
                                                       RadiusX="3"
                                                       RadiusY="3" />
                                        </Grid>
                                    </Grid>
                                </ControlTemplate>
                            </Setter.Value>
                        </Setter>
                    </Style>
                </controls:TopNavView.ItemContainerStyle>
                <controls:TopNavView.GroupStyle>
                    <GroupStyle>
                        <GroupStyle.HeaderContainerStyle>
                            <Style TargetType="ListViewHeaderItem">
                                <Setter Property="MinHeight"
                                        Value="0" />
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate>
                                            <Rectangle Fill="{ThemeResource CardStrokeColorDefaultBrush}"
                                                       Margin="8,4"
                                                       Height="1" />
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </GroupStyle.HeaderContainerStyle>
                    </GroupStyle>
                </controls:TopNavView.GroupStyle>
            </controls:TopNavView>

            <controls:ProfilePicture x:Name="PhotoSide"
                                     Click="Photo_Click"
                                     HorizontalAlignment="Left"
                                     VerticalAlignment="Bottom"
                                     Margin="22,8,0,18"
                                     Width="28"
                                     Height="28"
                                     AutomationProperties.LandmarkType="Navigation"
                                     AutomationProperties.Name="{CustomResource AccDescrOpenMenu}"
                                     ToolTipService.ToolTip="{CustomResource AccDescrOpenMenu}"
                                     Grid.Row="1" />
        </Grid>

        <controls:MasterDetailView x:Name="MasterDetail"
                                   ViewStateChanged="OnStateChanged"
                                   Update="OnUpdate"
                                   Grid.Column="1"
                                   Grid.Row="1">
            <controls:MasterDetailView.Banner>
                <Grid>
                    <controls:PlaybackHeader x:Name="Playback"
                                             x:Load="False" />

                    <Grid x:Name="CallBanner"
                          x:Load="False"
                          Height="40"
                          Background="{ThemeResource SystemControlHighlightAccentBrush}"
                          Grid.Row="2">
                        <Button Command="{x:Bind ViewModel.ReturnToCallCommand}"
                                HorizontalContentAlignment="Center"
                                VerticalContentAlignment="Center"
                                Style="{StaticResource EmptyButtonStyle}">
                            <TextBlock Text="{CustomResource ReturnToCall}"
                                       Foreground="White"
                                       Style="{StaticResource CaptionTextBlockStyle}" />
                        </Button>
                        <Border BorderThickness="0,0,0,1"
                                BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}"
                                IsHitTestVisible="False" />
                    </Grid>

                    <controls:GroupCallActiveHeader x:Load="False"
                                                    x:Name="GroupCallBanner" />
                </Grid>
            </controls:MasterDetailView.Banner>
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition />
                </Grid.RowDefinitions>
                <controls:ContentPageHeader x:Name="PageHeader"
                                            Background="Transparent"
                                            BackVisibility="Collapsed"
                                            Margin="0,-8,0,0">
                    <Grid x:Name="Header">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="40" />
                            <ColumnDefinition />
                        </Grid.ColumnDefinitions>
                        <Grid x:Name="MainHeader"
                              Padding="12,0,0,0"
                              Grid.ColumnSpan="2">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition />
                                <ColumnDefinition Width="Auto"
                                                  MinWidth="12" />
                            </Grid.ColumnDefinitions>
                            <Button x:Name="FocusTarget"
                                    Content="Nothing to see here, tab further"
                                    Width="12"
                                    Height="12"
                                    Opacity="0"
                                    Grid.ColumnSpan="2" />
                            <controls:ProfilePicture x:Name="Photo"
                                                     Click="Photo_Click"
                                                     VerticalAlignment="Center"
                                                     Margin="0,0,12,0"
                                                     Width="28"
                                                     Height="28"
                                                     AutomationProperties.LandmarkType="Navigation"
                                                     AutomationProperties.Name="{CustomResource AccDescrOpenMenu}"
                                                     ToolTipService.ToolTip="{CustomResource AccDescrOpenMenu}" />

                            <TextBox x:Name="SearchField"
                                     PlaceholderText="{CustomResource Search}"
                                     BorderBrush="{ThemeResource ControlStrokeColorDefaultBrush}"
                                     PreventKeyboardDisplayOnProgrammaticFocus="True"
                                     AutomationProperties.LandmarkType="Search"
                                     VerticalAlignment="Center"
                                     GotFocus="Search_Click"
                                     TextChanged="Search_TextChanged"
                                     KeyDown="Search_KeyDown"
                                     Grid.Column="1">
                                <TextBox.Header>
                                    <ItemsControl x:Name="Test"
                                                  x:Load="False"
                                                  ItemsSource="{x:Bind ViewModel.Chats.SearchFilters}"
                                                  Margin="-4,0,0,0">
                                        <ItemsControl.ItemTemplate>
                                            <DataTemplate x:DataType="collections:ISearchChatsFilter">
                                                <StackPanel Background="{ThemeResource SystemControlBackgroundAccentBrush}"
                                                            Orientation="Horizontal"
                                                            RequestedTheme="Dark"
                                                            Margin="8,4,-4,4"
                                                            CornerRadius="2">
                                                    <TextBlock Text="{x:Bind Glyph}"
                                                               Margin="8,0,8,0"
                                                               FontSize="16"
                                                               FontFamily="{StaticResource SymbolThemeFontFamily}"
                                                               VerticalAlignment="Center" />
                                                    <TextBlock Text="{x:Bind Text}"
                                                               TextWrapping="NoWrap"
                                                               TextTrimming="CharacterEllipsis"
                                                               Margin="0,0,8,0"
                                                               FontFamily="{ThemeResource EmojiThemeFontFamily}"
                                                               Style="{StaticResource BodyTextBlockStyle}"
                                                               VerticalAlignment="Center" />
                                                </StackPanel>
                                            </DataTemplate>
                                        </ItemsControl.ItemTemplate>
                                        <ItemsControl.ItemsPanel>
                                            <ItemsPanelTemplate>
                                                <StackPanel Orientation="Horizontal" />
                                            </ItemsPanelTemplate>
                                        </ItemsControl.ItemsPanel>
                                    </ItemsControl>
                                </TextBox.Header>
                            </TextBox>

                            <StackPanel x:Name="SettingsOptions"
                                        Orientation="Horizontal"
                                        VerticalAlignment="Center"
                                        Grid.Column="2">
                                <controls:MoreButton Width="40"
                                                     Height="40">
                                    <Button.Flyout>
                                        <MenuFlyout Placement="BottomEdgeAlignedRight">
                                            <MenuFlyoutItem Click="EditName_Click"
                                                            Text="{CustomResource EditName}">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon Glyph="&#xE104;"
                                                              Style="{StaticResource DefaultFontIconStyle}" />
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                            <MenuFlyoutItem Click="LogOut_Click"
                                                            Text="{CustomResource LogOut}">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon Glyph="&#xF3B1;"
                                                              Style="{StaticResource DefaultFontIconStyle}" />
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                        </MenuFlyout>
                                    </Button.Flyout>
                                </controls:MoreButton>
                            </StackPanel>
                            <StackPanel x:Name="ContactsOptions"
                                        Orientation="Horizontal"
                                        VerticalAlignment="Center"
                                        Grid.Column="2">
                                <controls:GlyphToggleButton Glyph="&#xE91B;"
                                                            CheckedGlyph="&#xE91E;"
                                                            IsChecked="{x:Bind ViewModel.Contacts.IsSortedByEpoch, Mode=TwoWay}"
                                                            Style="{StaticResource HeaderGlyphToggleButtonStyle}"
                                                            FontFamily="{StaticResource TelegramThemeFontFamily}"
                                                            AutomationProperties.Name="{CustomResource AccDescrContactSorting}"
                                                            ToolTipService.ToolTip="{CustomResource AccDescrContactSorting}"
                                                            IsOneWay="False"
                                                            Width="40"
                                                            Height="40" />
                            </StackPanel>
                            <StackPanel x:Name="ChatsOptions"
                                        Orientation="Horizontal"
                                        VerticalAlignment="Center"
                                        Grid.Column="2">
                                <controls:GlyphButton Glyph="&#xE996;"
                                                      AutomationProperties.Name="{CustomResource NewConversationShortcut}"
                                                      ToolTipService.ToolTip="{CustomResource NewConversationShortcut}"
                                                      FontSize="16"
                                                      VerticalAlignment="Center"
                                                      Margin="-36,0,0,0"
                                                      Width="36"
                                                      Height="32">
                                    <Button.Flyout>
                                        <MenuFlyout Placement="BottomEdgeAlignedRight">
                                            <MenuFlyoutItem Click="NewGroup_Click"
                                                            Text="{CustomResource NewGroup}">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon Glyph="&#xE716;"
                                                              Style="{StaticResource DefaultFontIconStyle}" />
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                            <MenuFlyoutItem Command="{x:Bind ViewModel.CreateSecretChatCommand}"
                                                            Text="{CustomResource NewSecretChat}">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon Glyph="&#xE916;"
                                                              Style="{StaticResource DefaultFontIconStyle}" />
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                            <MenuFlyoutItem Click="NewChannel_Click"
                                                            Text="{CustomResource NewChannel}">
                                                <MenuFlyoutItem.Icon>
                                                    <FontIcon Glyph="&#xE789;"
                                                              Style="{StaticResource DefaultFontIconStyle}" />
                                                </MenuFlyoutItem.Icon>
                                            </MenuFlyoutItem>
                                        </MenuFlyout>
                                    </Button.Flyout>
                                </controls:GlyphButton>
                                <controls:GlyphButton x:Name="Proxy"
                                                      Glyph="&#xEA19;"
                                                      Click="Proxy_Click"
                                                      Visibility="Collapsed"
                                                      FontFamily="{StaticResource TelegramThemeFontFamily}"
                                                      Style="{StaticResource HeaderGlyphButtonStyle}"
                                                      AutomationProperties.Name="{CustomResource ProxySettings}"
                                                      ToolTipService.ToolTip="{CustomResource ProxySettings}"
                                                      Width="40"
                                                      Height="40" />
                                <controls:GlyphButton x:Name="Lock"
                                                      Visibility="Collapsed"
                                                      Glyph="&#xE785;"
                                                      Click="Lock_Click"
                                                      Style="{StaticResource HeaderGlyphButtonStyle}"
                                                      AutomationProperties.Name="{CustomResource AccDescrPasscodeLock}"
                                                      ToolTipService.ToolTip="{CustomResource AccDescrPasscodeLock}"
                                                      Width="40"
                                                      Height="40" />
                            </StackPanel>
                        </Grid>

                        <Grid x:Name="ManagePanel"
                              Background="{ThemeResource PageHeaderBackgroundBrush}"
                              Visibility="Collapsed"
                              Grid.ColumnSpan="3">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <controls:GlyphButton x:Name="ManageMute"
                                                  Command="{x:Bind ViewModel.Chats.ChatsNotifyCommand}"
                                                  Style="{StaticResource HeaderGlyphButtonStyle}" />
                            <controls:GlyphButton x:Name="ManageMark"
                                                  Command="{x:Bind ViewModel.Chats.ChatsMarkCommand}"
                                                  FontFamily="{StaticResource TelegramThemeFontFamily}"
                                                  Style="{StaticResource HeaderGlyphButtonStyle}"
                                                  Grid.Column="1" />
                            <controls:GlyphButton Glyph="&#xE7B8;"
                                                  Command="{x:Bind ViewModel.Chats.ChatsArchiveCommand}"
                                                  AutomationProperties.Name="{CustomResource Archive}"
                                                  ToolTipService.ToolTip="{CustomResource Archive}"
                                                  Style="{StaticResource HeaderGlyphButtonStyle}"
                                                  Grid.Column="2" />
                            <controls:GlyphButton Glyph="&#xE74D;"
                                                  Command="{x:Bind ViewModel.Chats.ChatsDeleteCommand}"
                                                  AutomationProperties.Name="{CustomResource Delete}"
                                                  ToolTipService.ToolTip="{CustomResource Delete}"
                                                  Style="{StaticResource HeaderGlyphButtonStyle}"
                                                  Grid.Column="3" />
                            <controls:GlyphButton x:Name="ManageClear"
                                                  Glyph="&#xEA99;"
                                                  Command="{x:Bind ViewModel.Chats.ChatsClearCommand}"
                                                  AutomationProperties.Name="{CustomResource ClearHistory}"
                                                  ToolTipService.ToolTip="{CustomResource ClearHistory}"
                                                  Style="{StaticResource HeaderGlyphButtonStyle}"
                                                  Grid.Column="4" />

                            <ContentControl Content="{x:Bind ViewModel.Chats.SelectedItems.Count, Mode=OneWay}"
                                            HorizontalContentAlignment="Center"
                                            VerticalContentAlignment="Center"
                                            FontWeight="SemiBold"
                                            Padding="12,0"
                                            Height="{ThemeResource AppBarThemeCompactHeight}"
                                            Grid.Column="6">
                                <ContentControl.ContentTransitions>
                                    <TransitionCollection>
                                        <EntranceThemeTransition />
                                    </TransitionCollection>
                                </ContentControl.ContentTransitions>
                                <ContentControl.Clip>
                                    <RectangleGeometry Rect="0,0,200,48" />
                                </ContentControl.Clip>
                            </ContentControl>

                            <controls:GlyphButton Click="Manage_Click"
                                                  Glyph="&#xE711;"
                                                  Foreground="{ThemeResource SystemControlForegroundBaseHighBrush}"
                                                  Style="{StaticResource HeaderGlyphButtonStyle}"
                                                  Grid.Column="7" />
                        </Grid>
                    </Grid>
                </controls:ContentPageHeader>

                <Pivot x:Name="rpMasterTitlebar"
                       SelectionChanged="Pivot_SelectionChanged"
                       Style="{StaticResource HeaderlessPivotStyle}"
                       Grid.Row="1">
                    <PivotItem x:Name="TabChats"
                               Header="Chats">
                        <Grid>
                            <Grid x:Name="DialogsSearchPanel"
                                  x:Load="False">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition />
                                </Grid.RowDefinitions>
                                <ListView x:Load="False"
                                          x:Name="PippoFranco"
                                          SelectionMode="None"
                                          IsItemClickEnabled="True"
                                          ItemClick="SearchFilters_ItemClick"
                                          ContainerContentChanging="SearchFilters_ContainerContentChanging"
                                          ItemsSource="{x:Bind ViewModel.Chats.Search.Filters, Mode=OneWay}"
                                          Style="{StaticResource HorizontalListViewStyle}">
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Margin="12,0,8,0"
                                                           Text="&#xE77B;"
                                                           FontSize="16"
                                                           FontFamily="{StaticResource SymbolThemeFontFamily}"
                                                           Style="{StaticResource DisabledBodyTextBlockStyle}"
                                                           VerticalAlignment="Center" />
                                                <TextBlock TextWrapping="NoWrap"
                                                           TextTrimming="CharacterEllipsis"
                                                           Margin="0,0,12,0"
                                                           FontFamily="{ThemeResource EmojiThemeFontFamily}"
                                                           Style="{StaticResource DisabledBodyTextBlockStyle}"
                                                           VerticalAlignment="Center" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                    <ListView.ItemContainerStyle>
                                        <Style TargetType="ListViewItem">
                                            <Setter Property="MinWidth"
                                                    Value="0" />
                                            <Setter Property="Padding"
                                                    Value="0" />
                                        </Style>
                                    </ListView.ItemContainerStyle>
                                    <ListView.ItemContainerTransitions>
                                        <TransitionCollection />
                                    </ListView.ItemContainerTransitions>
                                </ListView>

                                <ListView x:Name="DialogsSearchListView"
                                          ItemsSource="{x:Bind ChatsResults.View, Mode=OneWay}"
                                          IsItemClickEnabled="True"
                                          SelectionMode="Single"
                                          ItemClick="ListView_ItemClick"
                                          ChoosingItemContainer="DialogsSearchListView_ChoosingItemContainer"
                                          ContainerContentChanging="DialogsSearchListView_ContainerContentChanging"
                                          SelectionChanged="ListView_SelectionChanged"
                                          Grid.Row="1">
                                    <ListView.Header>
                                        <StackPanel Visibility="{x:Bind ViewModel.Chats.TopChats, Mode=OneWay, Converter={StaticResource NullToVisibilityConverter}}">
                                            <controls:TextListView SelectionMode="None"
                                                                   IsItemClickEnabled="True"
                                                                   ItemClick="ListView_ItemClick"
                                                                   ContainerContentChanging="TopChats_ContainerContentChanging"
                                                                   ItemsSource="{x:Bind ViewModel.Chats.TopChats, Mode=OneWay}"
                                                                   Style="{StaticResource HorizontalListViewStyle}">
                                                <ListView.ItemTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Width="72"
                                                                    Padding="0,12"
                                                                    Background="Transparent"
                                                                    ContextRequested="TopChat_ContextRequested">
                                                            <Grid Width="48"
                                                                  Height="48"
                                                                  Margin="12,0">
                                                                <controls:ProfilePicture IsHitTestVisible="False"
                                                                                         IsTabStop="False" />
                                                                <Border Background="{ThemeResource ChatUnreadBadgeBrush}"
                                                                        MinWidth="20"
                                                                        Height="20"
                                                                        CornerRadius="10"
                                                                        VerticalAlignment="Top"
                                                                        HorizontalAlignment="Right"
                                                                        Margin="0,-2,-2,0"
                                                                        Visibility="Collapsed">
                                                                    <TextBlock Style="{StaticResource CaptionTextBlockStyle}"
                                                                               Foreground="{ThemeResource ChatUnreadLabelBrush}"
                                                                               TextAlignment="Center"
                                                                               Margin="4,2,4,0" />
                                                                </Border>
                                                                <Border Background="{ThemeResource ApplicationPageBackgroundThemeBrush}"
                                                                        Width="13"
                                                                        Height="13"
                                                                        CornerRadius="6.5"
                                                                        HorizontalAlignment="Right"
                                                                        VerticalAlignment="Bottom"
                                                                        Margin="0,0,1,1">
                                                                    <Border Background="{ThemeResource ChatOnlineBadgeBrush}"
                                                                            Width="9"
                                                                            Height="9"
                                                                            CornerRadius="4.5" />
                                                                </Border>
                                                            </Grid>

                                                            <TextBlock Margin="0,8,0,0"
                                                                       TextAlignment="Center"
                                                                       TextWrapping="NoWrap"
                                                                       TextTrimming="CharacterEllipsis"
                                                                       FontFamily="{ThemeResource EmojiThemeFontFamily}"
                                                                       Style="{StaticResource CaptionTextBlockStyle}" />
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </ListView.ItemTemplate>
                                                <ListView.ItemContainerStyle>
                                                    <Style TargetType="ListViewItem"
                                                           BasedOn="{StaticResource DefaultListViewItemStyle}">
                                                        <Setter Property="MinWidth"
                                                                Value="0" />
                                                        <Setter Property="Padding"
                                                                Value="0" />
                                                    </Style>
                                                </ListView.ItemContainerStyle>
                                                <ListView.ItemContainerTransitions>
                                                    <TransitionCollection />
                                                </ListView.ItemContainerTransitions>
                                            </controls:TextListView>

                                            <Grid Visibility="{x:Bind ViewModel.Chats.Search.Local.Count, Mode=OneWay, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="Auto" />
                                                </Grid.ColumnDefinitions>
                                                <TextBlock Text="{CustomResource Recent}"
                                                           Style="{StaticResource BaseTextBlockStyle}"
                                                           Margin="12,16,12,8" />
                                                <controls:GlyphButton Command="{x:Bind ViewModel.Chats.ClearRecentChatsCommand}"
                                                                      AllowFocusOnInteraction="False"
                                                                      VerticalAlignment="Bottom"
                                                                      Glyph="&#xE711;"
                                                                      FontSize="12"
                                                                      Width="48"
                                                                      Height="32"
                                                                      Grid.Column="1" />
                                            </Grid>
                                        </StackPanel>
                                    </ListView.Header>
                                    <ListView.ItemTemplateSelector>
                                        <selectors:SearchTemplateSelector>
                                            <selectors:SearchTemplateSelector.ChatTemplate>
                                                <DataTemplate>
                                                    <Grid Margin="12,6">
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="Auto" />
                                                            <RowDefinition Height="Auto" />
                                                        </Grid.RowDefinitions>
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="Auto" />
                                                            <ColumnDefinition />
                                                        </Grid.ColumnDefinitions>
                                                        <controls:ProfilePicture Width="36"
                                                                                 Height="36"
                                                                                 Margin="0,0,12,0"
                                                                                 Grid.RowSpan="2" />

                                                        <Grid VerticalAlignment="Bottom"
                                                              HorizontalAlignment="Left"
                                                              Grid.Column="1">
                                                            <Grid.ColumnDefinitions>
                                                                <ColumnDefinition />
                                                                <ColumnDefinition Width="Auto" />
                                                            </Grid.ColumnDefinitions>
                                                            <TextBlock TextWrapping="NoWrap"
                                                                       TextTrimming="CharacterEllipsis"
                                                                       VerticalAlignment="Bottom" />
                                                            <Grid Margin="4,0,0,-2"
                                                                  Grid.Column="1">
                                                                <Path Width="16"
                                                                      Height="16"
                                                                      Stretch="Uniform"
                                                                      Data="F1M33,0L23,3 12.999,0 9,9 0,13 2.999,23 0,33 9,37 12.999,46 23,43 33,46 37,37 46,33 43,23 46,13 37,9z M31.485,14.514L35.727,18.757 23.707,30.778 19.464,35.021 15.221,30.778 10.271,25.828 14.514,21.586 19.464,26.535z"
                                                                      Fill="{ThemeResource ChatVerifiedBadgeBrush}"
                                                                      StrokeThickness="0" />
                                                            </Grid>
                                                        </Grid>
                                                        <TextBlock VerticalAlignment="Top"
                                                                   Style="{StaticResource CaptionTextBlockStyle}"
                                                                   Foreground="{ThemeResource SystemControlDisabledChromeDisabledLowBrush}"
                                                                   FontFamily="{ThemeResource EmojiThemeFontFamily}"
                                                                   TextTrimming="CharacterEllipsis"
                                                                   TextWrapping="NoWrap"
                                                                   Grid.Column="1"
                                                                   Grid.Row="1"
                                                                   MaxLines="1" />
                                                    </Grid>
                                                </DataTemplate>
                                            </selectors:SearchTemplateSelector.ChatTemplate>
                                            <selectors:SearchTemplateSelector.MessageTemplate>
                                                <DataTemplate>
                                                    <cells:ChatCell Stroke="{ThemeResource ChatLastMessageStateBrush}"
                                                                    SelectionStroke="{ThemeResource ApplicationPageBackgroundThemeBrush}"
                                                                    IsEnabled="False" />
                                                </DataTemplate>
                                            </selectors:SearchTemplateSelector.MessageTemplate>
                                        </selectors:SearchTemplateSelector>
                                    </ListView.ItemTemplateSelector>
                                    <ListView.ItemContainerStyle>
                                        <Style TargetType="ListViewItem"
                                               BasedOn="{StaticResource DefaultListViewItemStyle}">
                                            <Setter Property="HorizontalContentAlignment"
                                                    Value="Stretch" />
                                        </Style>
                                    </ListView.ItemContainerStyle>
                                    <ListView.ItemContainerTransitions>
                                        <TransitionCollection />
                                    </ListView.ItemContainerTransitions>
                                    <ListView.GroupStyle>
                                        <GroupStyle>
                                            <GroupStyle.HeaderTemplate>
                                                <DataTemplate>
                                                    <!--<TextBlock Text="{Binding Key}" Style="{StaticResource BaseTextBlockStyle}"/>-->
                                                    <TextBlock Text="{Binding Key}"
                                                               Style="{StaticResource BaseTextBlockStyle}"
                                                               Margin="12,16,12,8" />
                                                </DataTemplate>
                                            </GroupStyle.HeaderTemplate>
                                            <GroupStyle.HeaderContainerStyle>
                                                <Style TargetType="ListViewHeaderItem">
                                                    <Setter Property="Background"
                                                            Value="Transparent" />
                                                    <Setter Property="FontFamily"
                                                            Value="{ThemeResource ContentControlThemeFontFamily}" />
                                                    <Setter Property="FontSize"
                                                            Value="{ThemeResource ListViewHeaderItemThemeFontSize}" />
                                                    <Setter Property="Margin"
                                                            Value="0,0,0,0" />
                                                    <Setter Property="Padding"
                                                            Value="12,0,12,0" />
                                                    <Setter Property="HorizontalContentAlignment"
                                                            Value="Stretch" />
                                                    <Setter Property="VerticalContentAlignment"
                                                            Value="Top" />
                                                    <Setter Property="MinHeight"
                                                            Value="0" />
                                                    <Setter Property="UseSystemFocusVisuals"
                                                            Value="True" />
                                                    <Setter Property="Template">
                                                        <Setter.Value>
                                                            <ControlTemplate TargetType="ListViewHeaderItem">
                                                                <Border Visibility="{Binding Content.Count, RelativeSource={RelativeSource Mode=TemplatedParent}, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                                    <Border Background="{TemplateBinding Background}"
                                                                            BorderBrush="{TemplateBinding BorderBrush}"
                                                                            BorderThickness="{TemplateBinding BorderThickness}"
                                                                            Visibility="{Binding Content.Key, RelativeSource={RelativeSource Mode=TemplatedParent}, Converter={StaticResource NullToVisibilityConverter}}">
                                                                        <ContentPresenter x:Name="ContentPresenter"
                                                                                          Margin="{TemplateBinding Padding}"
                                                                                          Content="{TemplateBinding Content}"
                                                                                          ContentTemplate="{TemplateBinding ContentTemplate}"
                                                                                          ContentTransitions="{TemplateBinding ContentTransitions}"
                                                                                          HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                                                          VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}" />
                                                                    </Border>
                                                                </Border>
                                                            </ControlTemplate>
                                                        </Setter.Value>
                                                    </Setter>
                                                </Style>
                                            </GroupStyle.HeaderContainerStyle>
                                        </GroupStyle>
                                    </ListView.GroupStyle>
                                </ListView>
                            </Grid>
                            <Grid x:Name="DialogsPanel">
                                <Grid x:Name="ChatsPanel">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition />
                                    </Grid.RowDefinitions>
                                    <Border x:Name="ChatTabs"
                                            x:Load="False">
                                        <Grid x:Name="ChatTabsView">
                                            <controls:TopNavView x:Name="ChatFilters"
                                                                 ItemsSource="{x:Bind ViewModel.Filters}"
                                                                 SelectedItem="{x:Bind ConvertFilter(ViewModel.SelectedFilter), Mode=TwoWay, BindBack=ConvertFilterBack}"
                                                                 IsItemClickEnabled="True"
                                                                 ItemClick="ChatFilter_ItemClick"
                                                                 ItemContextRequested="ChatFilter_ContextRequested"
                                                                 AllowDrop="True"
                                                                 CanDragItems="True"
                                                                 CanReorderItems="False"
                                                                 DragItemsStarting="ChatFilters_DragItemsStarting"
                                                                 DragItemsCompleted="ChatFilters_DragItemsCompleted"
                                                                 ScrollViewer.IsHorizontalScrollChainingEnabled="False"
                                                                 Height="40">
                                                <controls:TopNavView.ItemTemplate>
                                                    <DataTemplate x:DataType="viewModels:ChatFilterViewModel">
                                                        <StackPanel Orientation="Horizontal">
                                                            <TextBlock Text="{x:Bind Title, Mode=OneWay}"
                                                                       FontFamily="{ThemeResource EmojiThemeFontFamily}"
                                                                       VerticalAlignment="Top" />

                                                            <muxc:InfoBadge Value="{x:Bind UnreadCount, Mode=OneWay}"
                                                                            Visibility="{x:Bind ShowUnmuted, Mode=OneWay}"
                                                                            Background="{ThemeResource ChatUnreadBadgeBrush}"
                                                                            Foreground="{ThemeResource ChatUnreadLabelBrush}"
                                                                            Margin="8,0,0,0" />
                                                            <muxc:InfoBadge Value="{x:Bind UnreadMutedCount, Mode=OneWay}"
                                                                            Visibility="{x:Bind ShowMuted, Mode=OneWay}"
                                                                            Background="{ThemeResource ChatUnreadBadgeMutedBrush}"
                                                                            Foreground="{ThemeResource ChatUnreadLabelMutedBrush}"
                                                                            Margin="8,0,0,0" />
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </controls:TopNavView.ItemTemplate>
                                            </controls:TopNavView>

                                            <Border BorderBrush="{ThemeResource PageHeaderBorderBrush}"
                                                    BorderThickness="0,0,0,1"
                                                    VerticalAlignment="Bottom" />
                                        </Grid>
                                    </Border>

                                    <local:ChatListPage x:Name="ChatsList"
                                                        ItemClick="ListView_ItemClick"
                                                        IsItemClickEnabled="True"
                                                        AutomationProperties.LandmarkType="Main"
                                                        Main="{x:Bind ViewModel}"
                                                        DataContext="{x:Bind ViewModel.Chats}"
                                                        ItemsSource="{x:Bind ViewModel.Chats.Items, Mode=OneWay}"
                                                        SelectionMode="{x:Bind ViewModel.Chats.SelectionMode, Mode=TwoWay}"
                                                        SelectionChanged="ListView_SelectionChanged"
                                                        Grid.Row="1">
                                        <ListView.Header>
                                            <Grid x:Name="ArchivedChatsPresenter">
                                                <Button x:Name="ArchivedChatsPanel"
                                                        Click="ArchivedChats_Click"
                                                        ContextRequested="ArchivedChats_ContextRequested"
                                                        AutomationProperties.Name="{CustomResource ArchivedChats}"
                                                        Style="{StaticResource EmptyButtonStyle}"
                                                        Background="Transparent"
                                                        Padding="4,2"
                                                        CornerRadius="4">
                                                    <cells:ChatCell x:Name="ArchivedChats"
                                                                    Visibility="Collapsed"
                                                                    Stroke="{ThemeResource ChatLastMessageStateBrush}"
                                                                    SelectionStroke="{ThemeResource ApplicationPageBackgroundThemeBrush}"
                                                                    ActualThemeChanged="ArchivedChats_ActualThemeChanged" />
                                                </Button>
                                                <!--<Border VerticalAlignment="Bottom">
                                                    <Border x:Name="ArchivedChatsCompactPanel"
                                                            Background="{ThemeResource PageBackgroundDarkBrush}">
                                                        <Button Click="ArchivedChats_Click"
                                                                Content="{CustomResource ArchivedChats}"
                                                                ContextRequested="ArchivedChats_ContextRequested"
                                                                Style="{StaticResource EmptyButtonStyle}"
                                                                Visibility="{x:Bind ArchivedChats.Visibility, Mode=OneWay}"
                                                                BorderThickness="12,6" />
                                                    </Border>
                                                </Border>-->
                                            </Grid>
                                        </ListView.Header>
                                    </local:ChatListPage>
                                </Grid>

                                <controls:DownloadsFooter x:Name="Downloads"
                                                          Click="Downloads_Click"
                                                          VerticalAlignment="Bottom"
                                                          Visibility="Collapsed"
                                                          Grid.Row="1" />

                                <Grid VerticalAlignment="Bottom"
                                      HorizontalAlignment="Center"
                                      Margin="12"
                                      Grid.Row="1">
                                    <Rectangle x:Name="UpdateShadow"
                                               HorizontalAlignment="Stretch"
                                               VerticalAlignment="Stretch"
                                               Fill="{ThemeResource StartButtonBackground}"
                                               Margin="2"
                                               RadiusX="18"
                                               RadiusY="18" />
                                    <controls:BadgeButton x:Name="UpdateCloud"
                                                          Command="{x:Bind ViewModel.UpdateAppCommand}"
                                                          Visibility="{x:Bind ViewModel.IsUpdateAvailable, Mode=OneWay}"
                                                          Content="{CustomResource UpdateTelegram}"
                                                          Style="{StaticResource StartButtonStyle}"
                                                          Padding="16,3,16,5"
                                                          CornerRadius="18"
                                                          Margin="0"
                                                          Height="36" />
                                </Grid>

                                <controls:UndoView x:Name="Undo"
                                                   VerticalAlignment="Bottom"
                                                   Grid.Row="1" />
                            </Grid>
                        </Grid>
                    </PivotItem>
                    <PivotItem Header="{CustomResource Contacts}">
                        <Grid x:Name="ContactsRoot"
                              x:Load="False">
                            <ListView x:Name="ContactsSearchListView"
                                      x:Load="False"
                                      ItemsSource="{x:Bind ContactsResults.View, Mode=OneWay}"
                                      ItemContainerStyle="{StaticResource DefaultListViewItemStyle}"
                                      IsItemClickEnabled="True"
                                      SelectionMode="None"
                                      ItemClick="ListView_ItemClick"
                                      SelectionChanged="ListView_SelectionChanged"
                                      ContainerContentChanging="ContactsSearchListView_ContainerContentChanging">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <Grid Margin="12,4,12,8">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="Auto" />
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition />
                                            </Grid.ColumnDefinitions>
                                            <controls:ProfilePicture Width="36"
                                                                     Height="36"
                                                                     Margin="0,0,12,0"
                                                                     Grid.RowSpan="2" />

                                            <TextBlock TextWrapping="NoWrap"
                                                       TextTrimming="CharacterEllipsis"
                                                       Grid.Column="1"
                                                       VerticalAlignment="Bottom"
                                                       Grid.Row="0" />
                                            <TextBlock VerticalAlignment="Top"
                                                       Style="{StaticResource CaptionTextBlockStyle}"
                                                       Foreground="{ThemeResource SystemControlDisabledChromeDisabledLowBrush}"
                                                       TextTrimming="CharacterEllipsis"
                                                       TextWrapping="NoWrap"
                                                       Grid.Column="1"
                                                       Grid.Row="1"
                                                       MaxLines="1" />
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                                <ListView.ItemContainerTransitions>
                                    <TransitionCollection />
                                </ListView.ItemContainerTransitions>
                                <ListView.GroupStyle>
                                    <GroupStyle>
                                        <GroupStyle.HeaderTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding Key}"
                                                           Style="{StaticResource BaseTextBlockStyle}" />
                                            </DataTemplate>
                                        </GroupStyle.HeaderTemplate>
                                        <GroupStyle.HeaderContainerStyle>
                                            <Style TargetType="ListViewHeaderItem">
                                                <Setter Property="Background"
                                                        Value="Transparent" />
                                                <Setter Property="FontFamily"
                                                        Value="{ThemeResource ContentControlThemeFontFamily}" />
                                                <Setter Property="FontSize"
                                                        Value="{ThemeResource ListViewHeaderItemThemeFontSize}" />
                                                <Setter Property="Margin"
                                                        Value="0,0,0,0" />
                                                <Setter Property="Padding"
                                                        Value="12,16,12,8" />
                                                <Setter Property="HorizontalContentAlignment"
                                                        Value="Stretch" />
                                                <Setter Property="VerticalContentAlignment"
                                                        Value="Top" />
                                                <Setter Property="MinHeight"
                                                        Value="0" />
                                                <Setter Property="UseSystemFocusVisuals"
                                                        Value="True" />
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="ListViewHeaderItem">
                                                            <Border Visibility="{Binding Content.Count, RelativeSource={RelativeSource Mode=TemplatedParent}, Converter={StaticResource BooleanToVisibilityConverter}}">
                                                                <Border Background="{TemplateBinding Background}"
                                                                        BorderBrush="{TemplateBinding BorderBrush}"
                                                                        BorderThickness="{TemplateBinding BorderThickness}"
                                                                        Visibility="{Binding Content.Key, RelativeSource={RelativeSource Mode=TemplatedParent}, Converter={StaticResource NullToVisibilityConverter}}">
                                                                    <ContentPresenter x:Name="ContentPresenter"
                                                                                      Margin="{TemplateBinding Padding}"
                                                                                      Content="{TemplateBinding Content}"
                                                                                      ContentTemplate="{TemplateBinding ContentTemplate}"
                                                                                      ContentTransitions="{TemplateBinding ContentTransitions}"
                                                                                      HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}"
                                                                                      VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}" />
                                                                </Border>
                                                            </Border>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </GroupStyle.HeaderContainerStyle>
                                    </GroupStyle>
                                </ListView.GroupStyle>
                            </ListView>
                            <Grid x:Name="ContactsPanel">
                                <ListView x:Name="UsersListView"
                                          ItemsSource="{x:Bind ViewModel.Contacts.Items, Mode=OneWay}"
                                          ItemContainerStyle="{StaticResource DefaultListViewItemStyle}"
                                          IsItemClickEnabled="True"
                                          ItemClick="ListView_ItemClick"
                                          ChoosingItemContainer="UsersListView_ChoosingItemContainer"
                                          ContainerContentChanging="UsersListView_ContainerContentChanging"
                                          SelectionMode="None">
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Margin="12,6">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto" />
                                                    <RowDefinition Height="Auto" />
                                                </Grid.RowDefinitions>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto" />
                                                    <ColumnDefinition />
                                                </Grid.ColumnDefinitions>
                                                <controls:ProfilePicture IsEnabled="False"
                                                                         Width="36"
                                                                         Height="36"
                                                                         Margin="0,0,12,0"
                                                                         Grid.RowSpan="2" />

                                                <TextBlock TextWrapping="NoWrap"
                                                           TextTrimming="CharacterEllipsis"
                                                           Grid.Column="1"
                                                           VerticalAlignment="Bottom" />
                                                <TextBlock VerticalAlignment="Top"
                                                           Style="{StaticResource CaptionTextBlockStyle}"
                                                           Foreground="{ThemeResource SystemControlDisabledChromeDisabledLowBrush}"
                                                           TextTrimming="CharacterEllipsis"
                                                           TextWrapping="NoWrap"
                                                           Grid.Column="1"
                                                           Grid.Row="1"
                                                           MaxLines="1" />
                                            </Grid>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                    <ListView.Header>
                                        <StackPanel>
                                            <controls:BadgeButton Content="{CustomResource AddPeopleNearby}"
                                                                  Click="ChatsNearby_Click"
                                                                  Style="{StaticResource GlyphBadgeButtonStyle}"
                                                                  Glyph="&#xE1C4;" />

                                            <controls:BadgeButton Content="{CustomResource CreateNewContact}"
                                                                  Click="NewContact_Click"
                                                                  Style="{StaticResource GlyphBadgeButtonStyle}"
                                                                  Glyph="&#xE8FA;" />

                                            <Border>
                                                <TextBlock Text="{x:Bind ConvertSortedBy(ViewModel.Contacts.IsSortedByEpoch), Mode=OneWay}"
                                                           Padding="12,8,0,8"
                                                           Style="{StaticResource BaseTextBlockStyle}" />
                                            </Border>
                                        </StackPanel>
                                    </ListView.Header>
                                    <!--<ListView.ItemContainerTransitions>
                                         <TransitionCollection/>
                                         </ListView.ItemContainerTransitions>-->
                                </ListView>
                            </Grid>
                        </Grid>
                    </PivotItem>
                    <PivotItem x:Name="Calls"
                               Header="{CustomResource Calls}">
                        <Grid x:Name="CallsRoot"
                              x:Load="False">
                            <ListView ItemsSource="{x:Bind ViewModel.Calls.Items}"
                                      ItemContainerStyle="{StaticResource DefaultListViewItemStyle}"
                                      ItemClick="ListView_ItemClick"
                                      IsItemClickEnabled="True"
                                      ContainerContentChanging="Calls_ContainerContentChanging"
                                      SelectionMode="None">
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <cells:CallCell ContextRequested="Call_ContextRequested" />
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                                <!--<ListView.ItemContainerTransitions>
                                     <TransitionCollection/>
                                     </ListView.ItemContainerTransitions>-->
                            </ListView>
                        </Grid>
                    </PivotItem>
                    <PivotItem Header="{CustomResource Settings}">
                        <Grid x:Name="SettingsRoot"
                              x:Load="False">
                            <ListView ItemsSource="{x:Bind ViewModel.Settings.Results}"
                                      SelectionMode="None"
                                      ContainerContentChanging="Settings_ContainerContentChanging"
                                      Grid.Row="1">
                                <ListView.ItemContainerStyle>
                                    <Style TargetType="ListViewItem">
                                        <Setter Property="HorizontalContentAlignment"
                                                Value="Stretch" />
                                        <Setter Property="Padding"
                                                Value="0" />
                                    </Style>
                                </ListView.ItemContainerStyle>
                                <ListView.ItemTemplate>
                                    <DataTemplate>
                                        <controls:BadgeButton Style="{StaticResource IconSubbadgeBadgeButtonStyle}" />
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>

                            <local:SettingsPage x:Name="SettingsView"
                                                MasterDetail="{x:Bind MasterDetail}" />
                        </Grid>
                    </PivotItem>
                </Pivot>
            </Grid>
        </controls:MasterDetailView>

        <controls:ConfettiView x:Name="Confetti"
                               x:Load="False"
                               Completed="Confetti_Completed"
                               IsHitTestVisible="False"
                               Grid.ColumnSpan="2"
                               Grid.Row="1" />
    </Grid>
</Page>
