using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Unigram.Common
{
    public static class LocaleHelper
    {
        private static Dictionary<string, string> translitChars;

        public static string[] GetQuery(string src)
        {
            var translit = Transliterate(src);
            if (translit.Equals(src, StringComparison.OrdinalIgnoreCase))
            {
                translit = null;
            }

            var query = new string[translit == null ? 1 : 2];
            query[0] = src;

            if (translit != null)
            {
                query[1] = translit;
            }

            return query;
        }

        public static string Transliterate(string src)
        {
            if (translitChars == null)
            {
                translitChars = new Dictionary<string, string>(520);
                translitChars["ȼ"] = "c";
                translitChars["ᶇ"] = "n";
                translitChars["ɖ"] = "d";
                translitChars["ỿ"] = "y";
                translitChars["ᴓ"] = "o";
                translitChars["ø"] = "o";
                translitChars["ḁ"] = "a";
                translitChars["ʯ"] = "h";
                translitChars["ŷ"] = "y";
                translitChars["ʞ"] = "k";
                translitChars["ừ"] = "u";
                translitChars["ꜳ"] = "aa";
                translitChars["ĳ"] = "ij";
                translitChars["ḽ"] = "l";
                translitChars["ɪ"] = "i";
                translitChars["ḇ"] = "b";
                translitChars["ʀ"] = "r";
                translitChars["ě"] = "e";
                translitChars["ﬃ"] = "ffi";
                translitChars["ơ"] = "o";
                translitChars["ⱹ"] = "r";
                translitChars["ồ"] = "o";
                translitChars["ǐ"] = "i";
                translitChars["ꝕ"] = "p";
                translitChars["ý"] = "y";
                translitChars["ḝ"] = "e";
                translitChars["ₒ"] = "o";
                translitChars["ⱥ"] = "a";
                translitChars["ʙ"] = "b";
                translitChars["ḛ"] = "e";
                translitChars["ƈ"] = "c";
                translitChars["ɦ"] = "h";
                translitChars["ᵬ"] = "b";
                translitChars["ṣ"] = "s";
                translitChars["đ"] = "d";
                translitChars["ỗ"] = "o";
                translitChars["ɟ"] = "j";
                translitChars["ẚ"] = "a";
                translitChars["ɏ"] = "y";
                translitChars["л"] = "l";
                translitChars["ʌ"] = "v";
                translitChars["ꝓ"] = "p";
                translitChars["ﬁ"] = "fi";
                translitChars["ᶄ"] = "k";
                translitChars["ḏ"] = "d";
                translitChars["ᴌ"] = "l";
                translitChars["ė"] = "e";
                translitChars["ё"] = "yo";
                translitChars["ᴋ"] = "k";
                translitChars["ċ"] = "c";
                translitChars["ʁ"] = "r";
                translitChars["ƕ"] = "hv";
                translitChars["ƀ"] = "b";
                translitChars["ṍ"] = "o";
                translitChars["ȣ"] = "ou";
                translitChars["ǰ"] = "j";
                translitChars["ᶃ"] = "g";
                translitChars["ṋ"] = "n";
                translitChars["ɉ"] = "j";
                translitChars["ǧ"] = "g";
                translitChars["ǳ"] = "dz";
                translitChars["ź"] = "z";
                translitChars["ꜷ"] = "au";
                translitChars["ǖ"] = "u";
                translitChars["ᵹ"] = "g";
                translitChars["ȯ"] = "o";
                translitChars["ɐ"] = "a";
                translitChars["ą"] = "a";
                translitChars["õ"] = "o";
                translitChars["ɻ"] = "r";
                translitChars["ꝍ"] = "o";
                translitChars["ǟ"] = "a";
                translitChars["ȴ"] = "l";
                translitChars["ʂ"] = "s";
                translitChars["ﬂ"] = "fl";
                translitChars["ȉ"] = "i";
                translitChars["ⱻ"] = "e";
                translitChars["ṉ"] = "n";
                translitChars["ï"] = "i";
                translitChars["ñ"] = "n";
                translitChars["ᴉ"] = "i";
                translitChars["ʇ"] = "t";
                translitChars["ẓ"] = "z";
                translitChars["ỷ"] = "y";
                translitChars["ȳ"] = "y";
                translitChars["ṩ"] = "s";
                translitChars["ɽ"] = "r";
                translitChars["ĝ"] = "g";
                translitChars["в"] = "v";
                translitChars["ᴝ"] = "u";
                translitChars["ḳ"] = "k";
                translitChars["ꝫ"] = "et";
                translitChars["ī"] = "i";
                translitChars["ť"] = "t";
                translitChars["ꜿ"] = "c";
                translitChars["ʟ"] = "l";
                translitChars["ꜹ"] = "av";
                translitChars["û"] = "u";
                translitChars["æ"] = "ae";
                translitChars["и"] = "i";
                translitChars["ă"] = "a";
                translitChars["ǘ"] = "u";
                translitChars["ꞅ"] = "s";
                translitChars["ᵣ"] = "r";
                translitChars["ᴀ"] = "a";
                translitChars["ƃ"] = "b";
                translitChars["ḩ"] = "h";
                translitChars["ṧ"] = "s";
                translitChars["ₑ"] = "e";
                translitChars["ʜ"] = "h";
                translitChars["ẋ"] = "x";
                translitChars["ꝅ"] = "k";
                translitChars["ḋ"] = "d";
                translitChars["ƣ"] = "oi";
                translitChars["ꝑ"] = "p";
                translitChars["ħ"] = "h";
                translitChars["ⱴ"] = "v";
                translitChars["ẇ"] = "w";
                translitChars["ǹ"] = "n";
                translitChars["ɯ"] = "m";
                translitChars["ɡ"] = "g";
                translitChars["ɴ"] = "n";
                translitChars["ᴘ"] = "p";
                translitChars["ᵥ"] = "v";
                translitChars["ū"] = "u";
                translitChars["ḃ"] = "b";
                translitChars["ṗ"] = "p";
                translitChars["ь"] = "";
                translitChars["å"] = "a";
                translitChars["ɕ"] = "c";
                translitChars["ọ"] = "o";
                translitChars["ắ"] = "a";
                translitChars["ƒ"] = "f";
                translitChars["ǣ"] = "ae";
                translitChars["ꝡ"] = "vy";
                translitChars["ﬀ"] = "ff";
                translitChars["ᶉ"] = "r";
                translitChars["ô"] = "o";
                translitChars["ǿ"] = "o";
                translitChars["ṳ"] = "u";
                translitChars["ȥ"] = "z";
                translitChars["ḟ"] = "f";
                translitChars["ḓ"] = "d";
                translitChars["ȇ"] = "e";
                translitChars["ȕ"] = "u";
                translitChars["п"] = "p";
                translitChars["ȵ"] = "n";
                translitChars["ʠ"] = "q";
                translitChars["ấ"] = "a";
                translitChars["ǩ"] = "k";
                translitChars["ĩ"] = "i";
                translitChars["ṵ"] = "u";
                translitChars["ŧ"] = "t";
                translitChars["ɾ"] = "r";
                translitChars["ƙ"] = "k";
                translitChars["ṫ"] = "t";
                translitChars["ꝗ"] = "q";
                translitChars["ậ"] = "a";
                translitChars["н"] = "n";
                translitChars["ʄ"] = "j";
                translitChars["ƚ"] = "l";
                translitChars["ᶂ"] = "f";
                translitChars["д"] = "d";
                translitChars["ᵴ"] = "s";
                translitChars["ꞃ"] = "r";
                translitChars["ᶌ"] = "v";
                translitChars["ɵ"] = "o";
                translitChars["ḉ"] = "c";
                translitChars["ᵤ"] = "u";
                translitChars["ẑ"] = "z";
                translitChars["ṹ"] = "u";
                translitChars["ň"] = "n";
                translitChars["ʍ"] = "w";
                translitChars["ầ"] = "a";
                translitChars["ǉ"] = "lj";
                translitChars["ɓ"] = "b";
                translitChars["ɼ"] = "r";
                translitChars["ò"] = "o";
                translitChars["ẘ"] = "w";
                translitChars["ɗ"] = "d";
                translitChars["ꜽ"] = "ay";
                translitChars["ư"] = "u";
                translitChars["ᶀ"] = "b";
                translitChars["ǜ"] = "u";
                translitChars["ẹ"] = "e";
                translitChars["ǡ"] = "a";
                translitChars["ɥ"] = "h";
                translitChars["ṏ"] = "o";
                translitChars["ǔ"] = "u";
                translitChars["ʎ"] = "y";
                translitChars["ȱ"] = "o";
                translitChars["ệ"] = "e";
                translitChars["ế"] = "e";
                translitChars["ĭ"] = "i";
                translitChars["ⱸ"] = "e";
                translitChars["ṯ"] = "t";
                translitChars["ᶑ"] = "d";
                translitChars["ḧ"] = "h";
                translitChars["ṥ"] = "s";
                translitChars["ë"] = "e";
                translitChars["ᴍ"] = "m";
                translitChars["ö"] = "o";
                translitChars["é"] = "e";
                translitChars["ı"] = "i";
                translitChars["ď"] = "d";
                translitChars["ᵯ"] = "m";
                translitChars["ỵ"] = "y";
                translitChars["я"] = "ya";
                translitChars["ŵ"] = "w";
                translitChars["ề"] = "e";
                translitChars["ứ"] = "u";
                translitChars["ƶ"] = "z";
                translitChars["ĵ"] = "j";
                translitChars["ḍ"] = "d";
                translitChars["ŭ"] = "u";
                translitChars["ʝ"] = "j";
                translitChars["ж"] = "zh";
                translitChars["ê"] = "e";
                translitChars["ǚ"] = "u";
                translitChars["ġ"] = "g";
                translitChars["ṙ"] = "r";
                translitChars["ƞ"] = "n";
                translitChars["ъ"] = "";
                translitChars["ḗ"] = "e";
                translitChars["ẝ"] = "s";
                translitChars["ᶁ"] = "d";
                translitChars["ķ"] = "k";
                translitChars["ᴂ"] = "ae";
                translitChars["ɘ"] = "e";
                translitChars["ợ"] = "o";
                translitChars["ḿ"] = "m";
                translitChars["ꜰ"] = "f";
                translitChars["а"] = "a";
                translitChars["ẵ"] = "a";
                translitChars["ꝏ"] = "oo";
                translitChars["ᶆ"] = "m";
                translitChars["ᵽ"] = "p";
                translitChars["ц"] = "ts";
                translitChars["ữ"] = "u";
                translitChars["ⱪ"] = "k";
                translitChars["ḥ"] = "h";
                translitChars["ţ"] = "t";
                translitChars["ᵱ"] = "p";
                translitChars["ṁ"] = "m";
                translitChars["á"] = "a";
                translitChars["ᴎ"] = "n";
                translitChars["ꝟ"] = "v";
                translitChars["è"] = "e";
                translitChars["ᶎ"] = "z";
                translitChars["ꝺ"] = "d";
                translitChars["ᶈ"] = "p";
                translitChars["м"] = "m";
                translitChars["ɫ"] = "l";
                translitChars["ᴢ"] = "z";
                translitChars["ɱ"] = "m";
                translitChars["ṝ"] = "r";
                translitChars["ṽ"] = "v";
                translitChars["ũ"] = "u";
                translitChars["ß"] = "ss";
                translitChars["т"] = "t";
                translitChars["ĥ"] = "h";
                translitChars["ᵵ"] = "t";
                translitChars["ʐ"] = "z";
                translitChars["ṟ"] = "r";
                translitChars["ɲ"] = "n";
                translitChars["à"] = "a";
                translitChars["ẙ"] = "y";
                translitChars["ỳ"] = "y";
                translitChars["ᴔ"] = "oe";
                translitChars["ы"] = "i";
                translitChars["ₓ"] = "x";
                translitChars["ȗ"] = "u";
                translitChars["ⱼ"] = "j";
                translitChars["ẫ"] = "a";
                translitChars["ʑ"] = "z";
                translitChars["ẛ"] = "s";
                translitChars["ḭ"] = "i";
                translitChars["ꜵ"] = "ao";
                translitChars["ɀ"] = "z";
                translitChars["ÿ"] = "y";
                translitChars["ǝ"] = "e";
                translitChars["ǭ"] = "o";
                translitChars["ᴅ"] = "d";
                translitChars["ᶅ"] = "l";
                translitChars["ù"] = "u";
                translitChars["ạ"] = "a";
                translitChars["ḅ"] = "b";
                translitChars["ụ"] = "u";
                translitChars["к"] = "k";
                translitChars["ằ"] = "a";
                translitChars["ᴛ"] = "t";
                translitChars["ƴ"] = "y";
                translitChars["ⱦ"] = "t";
                translitChars["з"] = "z";
                translitChars["ⱡ"] = "l";
                translitChars["ȷ"] = "j";
                translitChars["ᵶ"] = "z";
                translitChars["ḫ"] = "h";
                translitChars["ⱳ"] = "w";
                translitChars["ḵ"] = "k";
                translitChars["ờ"] = "o";
                translitChars["î"] = "i";
                translitChars["ģ"] = "g";
                translitChars["ȅ"] = "e";
                translitChars["ȧ"] = "a";
                translitChars["ẳ"] = "a";
                translitChars["щ"] = "sch";
                translitChars["ɋ"] = "q";
                translitChars["ṭ"] = "t";
                translitChars["ꝸ"] = "um";
                translitChars["ᴄ"] = "c";
                translitChars["ẍ"] = "x";
                translitChars["ủ"] = "u";
                translitChars["ỉ"] = "i";
                translitChars["ᴚ"] = "r";
                translitChars["ś"] = "s";
                translitChars["ꝋ"] = "o";
                translitChars["ỹ"] = "y";
                translitChars["ṡ"] = "s";
                translitChars["ǌ"] = "nj";
                translitChars["ȁ"] = "a";
                translitChars["ẗ"] = "t";
                translitChars["ĺ"] = "l";
                translitChars["ž"] = "z";
                translitChars["ᵺ"] = "th";
                translitChars["ƌ"] = "d";
                translitChars["ș"] = "s";
                translitChars["š"] = "s";
                translitChars["ᶙ"] = "u";
                translitChars["ẽ"] = "e";
                translitChars["ẜ"] = "s";
                translitChars["ɇ"] = "e";
                translitChars["ṷ"] = "u";
                translitChars["ố"] = "o";
                translitChars["ȿ"] = "s";
                translitChars["ᴠ"] = "v";
                translitChars["ꝭ"] = "is";
                translitChars["ᴏ"] = "o";
                translitChars["ɛ"] = "e";
                translitChars["ǻ"] = "a";
                translitChars["ﬄ"] = "ffl";
                translitChars["ⱺ"] = "o";
                translitChars["ȋ"] = "i";
                translitChars["ᵫ"] = "ue";
                translitChars["ȡ"] = "d";
                translitChars["ⱬ"] = "z";
                translitChars["ẁ"] = "w";
                translitChars["ᶏ"] = "a";
                translitChars["ꞇ"] = "t";
                translitChars["ğ"] = "g";
                translitChars["ɳ"] = "n";
                translitChars["ʛ"] = "g";
                translitChars["ᴜ"] = "u";
                translitChars["ф"] = "f";
                translitChars["ẩ"] = "a";
                translitChars["ṅ"] = "n";
                translitChars["ɨ"] = "i";
                translitChars["ᴙ"] = "r";
                translitChars["ǎ"] = "a";
                translitChars["ſ"] = "s";
                translitChars["у"] = "u";
                translitChars["ȫ"] = "o";
                translitChars["ɿ"] = "r";
                translitChars["ƭ"] = "t";
                translitChars["ḯ"] = "i";
                translitChars["ǽ"] = "ae";
                translitChars["ⱱ"] = "v";
                translitChars["ɶ"] = "oe";
                translitChars["ṃ"] = "m";
                translitChars["ż"] = "z";
                translitChars["ĕ"] = "e";
                translitChars["ꜻ"] = "av";
                translitChars["ở"] = "o";
                translitChars["ễ"] = "e";
                translitChars["ɬ"] = "l";
                translitChars["ị"] = "i";
                translitChars["ᵭ"] = "d";
                translitChars["ﬆ"] = "st";
                translitChars["ḷ"] = "l";
                translitChars["ŕ"] = "r";
                translitChars["ᴕ"] = "ou";
                translitChars["ʈ"] = "t";
                translitChars["ā"] = "a";
                translitChars["э"] = "e";
                translitChars["ḙ"] = "e";
                translitChars["ᴑ"] = "o";
                translitChars["ç"] = "c";
                translitChars["ᶊ"] = "s";
                translitChars["ặ"] = "a";
                translitChars["ų"] = "u";
                translitChars["ả"] = "a";
                translitChars["ǥ"] = "g";
                translitChars["р"] = "r";
                translitChars["ꝁ"] = "k";
                translitChars["ẕ"] = "z";
                translitChars["ŝ"] = "s";
                translitChars["ḕ"] = "e";
                translitChars["ɠ"] = "g";
                translitChars["ꝉ"] = "l";
                translitChars["ꝼ"] = "f";
                translitChars["ᶍ"] = "x";
                translitChars["х"] = "h";
                translitChars["ǒ"] = "o";
                translitChars["ę"] = "e";
                translitChars["ổ"] = "o";
                translitChars["ƫ"] = "t";
                translitChars["ǫ"] = "o";
                translitChars["i̇"] = "i";
                translitChars["ṇ"] = "n";
                translitChars["ć"] = "c";
                translitChars["ᵷ"] = "g";
                translitChars["ẅ"] = "w";
                translitChars["ḑ"] = "d";
                translitChars["ḹ"] = "l";
                translitChars["ч"] = "ch";
                translitChars["œ"] = "oe";
                translitChars["ᵳ"] = "r";
                translitChars["ļ"] = "l";
                translitChars["ȑ"] = "r";
                translitChars["ȭ"] = "o";
                translitChars["ᵰ"] = "n";
                translitChars["ᴁ"] = "ae";
                translitChars["ŀ"] = "l";
                translitChars["ä"] = "a";
                translitChars["ƥ"] = "p";
                translitChars["ỏ"] = "o";
                translitChars["į"] = "i";
                translitChars["ȓ"] = "r";
                translitChars["ǆ"] = "dz";
                translitChars["ḡ"] = "g";
                translitChars["ṻ"] = "u";
                translitChars["ō"] = "o";
                translitChars["ľ"] = "l";
                translitChars["ẃ"] = "w";
                translitChars["ț"] = "t";
                translitChars["ń"] = "n";
                translitChars["ɍ"] = "r";
                translitChars["ȃ"] = "a";
                translitChars["ü"] = "u";
                translitChars["ꞁ"] = "l";
                translitChars["ᴐ"] = "o";
                translitChars["ớ"] = "o";
                translitChars["ᴃ"] = "b";
                translitChars["ɹ"] = "r";
                translitChars["ᵲ"] = "r";
                translitChars["ʏ"] = "y";
                translitChars["ᵮ"] = "f";
                translitChars["ⱨ"] = "h";
                translitChars["ŏ"] = "o";
                translitChars["ú"] = "u";
                translitChars["ṛ"] = "r";
                translitChars["ʮ"] = "h";
                translitChars["ó"] = "o";
                translitChars["ů"] = "u";
                translitChars["ỡ"] = "o";
                translitChars["ṕ"] = "p";
                translitChars["ᶖ"] = "i";
                translitChars["ự"] = "u";
                translitChars["ã"] = "a";
                translitChars["ᵢ"] = "i";
                translitChars["ṱ"] = "t";
                translitChars["ể"] = "e";
                translitChars["ử"] = "u";
                translitChars["í"] = "i";
                translitChars["ɔ"] = "o";
                translitChars["с"] = "s";
                translitChars["й"] = "i";
                translitChars["ɺ"] = "r";
                translitChars["ɢ"] = "g";
                translitChars["ř"] = "r";
                translitChars["ẖ"] = "h";
                translitChars["ű"] = "u";
                translitChars["ȍ"] = "o";
                translitChars["ш"] = "sh";
                translitChars["ḻ"] = "l";
                translitChars["ḣ"] = "h";
                translitChars["ȶ"] = "t";
                translitChars["ņ"] = "n";
                translitChars["ᶒ"] = "e";
                translitChars["ì"] = "i";
                translitChars["ẉ"] = "w";
                translitChars["б"] = "b";
                translitChars["ē"] = "e";
                translitChars["ᴇ"] = "e";
                translitChars["ł"] = "l";
                translitChars["ộ"] = "o";
                translitChars["ɭ"] = "l";
                translitChars["ẏ"] = "y";
                translitChars["ᴊ"] = "j";
                translitChars["ḱ"] = "k";
                translitChars["ṿ"] = "v";
                translitChars["ȩ"] = "e";
                translitChars["â"] = "a";
                translitChars["ş"] = "s";
                translitChars["ŗ"] = "r";
                translitChars["ʋ"] = "v";
                translitChars["ₐ"] = "a";
                translitChars["ↄ"] = "c";
                translitChars["ᶓ"] = "e";
                translitChars["ɰ"] = "m";
                translitChars["е"] = "e";
                translitChars["ᴡ"] = "w";
                translitChars["ȏ"] = "o";
                translitChars["č"] = "c";
                translitChars["ǵ"] = "g";
                translitChars["ĉ"] = "c";
                translitChars["ю"] = "yu";
                translitChars["ᶗ"] = "o";
                translitChars["ꝃ"] = "k";
                translitChars["ꝙ"] = "q";
                translitChars["г"] = "g";
                translitChars["ṑ"] = "o";
                translitChars["ꜱ"] = "s";
                translitChars["ṓ"] = "o";
                translitChars["ȟ"] = "h";
                translitChars["ő"] = "o";
                translitChars["ꜩ"] = "tz";
                translitChars["ẻ"] = "e";
                translitChars["о"] = "o";
            }

            src = src.ToLower();

            var dst = new StringBuilder(src.Length);
            var len = src.Length;
            for (int a = 0; a < len; a++)
            {
                var ch = src.Substring(a, 1);
                if (translitChars.TryGetValue(ch, out string tch))
                {
                    dst.Append(tch);
                }
                else
                {
                    dst.Append(ch);
                }
            }
            return dst.ToString();
        }
    }
}
